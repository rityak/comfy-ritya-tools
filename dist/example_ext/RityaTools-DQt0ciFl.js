import{j as e}from"./main.js";import{r as c}from"./vendor-nf7bT_Uh.js";function ce({text:i,label:w="Copy",onCopy:j,className:A="",disabled:b=!1}){const B=()=>{var F,H;b||(navigator.clipboard.writeText(i),(H=(F=window.app)==null?void 0:F.extensionManager)!=null&&H.toast?window.app.extensionManager.toast.add({severity:"success",summary:"Copied",detail:"Content copied to clipboard",life:3e3}):alert("Copied to clipboard!"),j==null||j())};return e.jsx("button",{onClick:B,className:`copy-btn ${A}`,disabled:b,children:w})}function me({json:i,title:w="Generated JSON",showCopyButton:j=!0,maxHeight:A="200px"}){return e.jsxs("div",{className:"json-preview",children:[w&&e.jsx("h3",{children:w}),e.jsx("pre",{className:"json-display",style:{maxHeight:A},children:i}),j&&e.jsx(ce,{text:i,label:"Copy JSON",className:"full-width"})]})}function de({label:i,active:w,onClick:j}){return e.jsx("button",{className:`tab-button ${w?"active":""}`,onClick:j,children:i})}const ne=[{name:"IN",label:"Input Blocks",subBlocks:Array.from({length:9},(i,w)=>`IN${w.toString().padStart(2,"0")}`)},{name:"M",label:"Middle Block",subBlocks:["M00"]},{name:"OUT",label:"Output Blocks",subBlocks:Array.from({length:9},(i,w)=>`OUT${w.toString().padStart(2,"0")}`)},{name:"CLIP_L",label:"CLIP L",subBlocks:[]},{name:"CLIP_G",label:"CLIP G",subBlocks:[]},{name:"time_embed",label:"Time Embed",subBlocks:[]},{name:"label_emb",label:"Label Embed",subBlocks:[]}];function Ae(){const[i,w]=c.useState(2),[j,A]=c.useState([.5,.5]),[b,B]=c.useState({global:"0.5,0.5",max_iter:10,tol:1e-5}),[F,H]=c.useState(!1),[_,q]=c.useState(!1),[y,P]=c.useState({}),[C,K]=c.useState({});c.useEffect(()=>{const s=Array(i).fill(1/i);A(s),B(p=>({...p,global:s.map(N=>N.toFixed(3)).join(",")}));const t={},n={};ne.forEach(p=>{p.subBlocks.length>0&&p.subBlocks.forEach(N=>{t[N]=s.map(V=>V.toFixed(3)).join(","),n[N]=!1}),t[p.name]=s.map(N=>N.toFixed(3)).join(","),n[p.name]=!1}),P(t),K(n)},[i]),c.useEffect(()=>{B(s=>({...s,global:j.map(t=>t.toFixed(3)).join(",")}))},[j]);const U=(s,t)=>{const n=[...j];n[s]=parseFloat(t),A(n)},Y=()=>{const s=j.reduce((n,p)=>n+p,0);if(s===0)return;const t=j.map(n=>n/s);A(t)},D=()=>{const s={global:b.global,max_iter:b.max_iter,tol:b.tol};if(_){const t=[];ne.forEach(p=>{p.subBlocks.forEach(N=>{const V=y[p.name]||b.global;C[N]&&y[N]!==V&&y[N]!==b.global&&t.push({name:N,weight:y[N]})})});const n=[];ne.forEach(p=>{C[p.name]&&y[p.name]!==b.global&&n.push({name:p.name,weight:y[p.name]})}),[...t,...n].forEach(p=>{s[p.name]=p.weight})}return JSON.stringify(s,null,2)},[I,J]=c.useState(["Model 1","Model 2"]);c.useEffect(()=>{const s=Array.from({length:i},(t,n)=>`Model ${n+1}`);J(s)},[i]);const ee=(s,t)=>{const n=[...I];n[s]=t||`Model ${s+1}`,J(n)},E=(s,t)=>{P(n=>({...n,[s]:t}))},Z=s=>{K(t=>({...t,[s]:!t[s]}))},L=s=>{const n=(y[s]||b.global).split(",").map(R=>parseFloat(R)||0),p=n.reduce((R,le)=>R+le,0);if(p===0)return;const V=n.map(R=>R/p).map(R=>R.toFixed(3)).join(",");E(s,V)},se=()=>{const s=Array(i).fill(1/i);A(s),B({global:s.map(p=>p.toFixed(3)).join(","),max_iter:10,tol:1e-5});const t={},n={};ne.forEach(p=>{p.subBlocks.length>0&&p.subBlocks.forEach(N=>{t[N]=s.map(V=>V.toFixed(3)).join(","),n[N]=!1}),t[p.name]=s.map(N=>N.toFixed(3)).join(","),n[p.name]=!1}),P(t),K(n)},$=()=>e.jsxs("div",{className:"model-weights-section",children:[e.jsx("h3",{children:"Model Weights"}),e.jsx("div",{className:"model-sliders",children:j.map((s,t)=>e.jsxs("div",{className:"model-slider-container",children:[e.jsxs("div",{className:"slider-label-row",children:[e.jsx("input",{type:"text",value:I[t],onChange:n=>ee(t,n.target.value),className:"model-name-input"}),e.jsxs("span",{children:[(s*100).toFixed(1),"%"]})]}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:s,onChange:n=>U(t,n.target.value),className:"slider"}),e.jsx("div",{className:"weight-value",children:s.toFixed(3)})]},t))}),e.jsx("div",{className:"normalize-row",children:e.jsx("button",{onClick:Y,className:"normalize-btn",children:"Normalize Global Weights"})})]}),G=()=>_?e.jsxs("div",{className:"block-controls",children:[e.jsx("h3",{children:"Block Weights"}),e.jsx("div",{className:"blocks-grid",children:ne.map(s=>e.jsxs("div",{className:"block-group",children:[e.jsxs("div",{className:"group-header",children:[e.jsxs("div",{className:"group-label",children:[e.jsx("input",{type:"checkbox",checked:C[s.name]||!1,onChange:()=>Z(s.name),id:`group-${s.name}`}),e.jsx("label",{htmlFor:`group-${s.name}`,children:s.label})]}),e.jsxs("div",{className:"group-input-row",children:[e.jsx("input",{type:"text",value:y[s.name]||b.global,onChange:t=>E(s.name,t.target.value),disabled:!C[s.name],placeholder:"Comma separated weights",className:"weights-input"}),e.jsx("button",{onClick:()=>L(s.name),disabled:!C[s.name],className:"normalize-btn small",children:"Normalize"})]})]}),s.subBlocks.length>0&&e.jsx("div",{className:"sub-blocks",children:s.subBlocks.map(t=>e.jsxs("div",{className:"sub-block",children:[e.jsxs("div",{className:"sub-block-content",children:[e.jsx("input",{type:"checkbox",checked:C[t]||!1,onChange:()=>Z(t),id:`sub-${t}`}),e.jsx("label",{htmlFor:`sub-${t}`,children:t})]}),e.jsxs("div",{className:"sub-block-input-row",children:[e.jsx("input",{type:"text",value:y[t]||y[s.name]||b.global,onChange:n=>E(t,n.target.value),disabled:!C[t],placeholder:`Weights for ${t}`,className:"weights-input"}),e.jsx("button",{onClick:()=>L(t),disabled:!C[t],className:"normalize-btn small",children:"Normalize"})]})]},t))})]},s.name))})]}):null,d=()=>{const s=[];if(ne.forEach(t=>{if(t.subBlocks.length>0&&t.subBlocks.forEach(n=>{if(C[n]){const p=y[n]||b.global,N=p?p.split(",").map(V=>parseFloat(V)||0):Array(i).fill(0);s.push({name:n,weights:N,type:"specific"})}}),C[t.name]){const n=y[t.name]||b.global,p=n?n.split(",").map(N=>parseFloat(N)||0):Array(i).fill(0);s.push({name:t.name,weights:p,type:"group"})}}),s.length===0){const t=b.global?b.global.split(",").map(n=>parseFloat(n)||0):Array(i).fill(0);s.push({name:"global",weights:t,type:"global"})}return e.jsxs("div",{className:"heatmap",children:[e.jsx("h3",{children:"Block Weights Visualization"}),e.jsxs("div",{className:"heatmap-grid",children:[e.jsxs("div",{className:"heatmap-headers",children:[e.jsx("div",{className:"block-label",children:"Block"}),Array.from({length:i}).map((t,n)=>e.jsx("div",{className:"model-header",children:I[n]||`Model ${n+1}`},n))]}),s.map((t,n)=>e.jsxs("div",{className:"heatmap-row",children:[e.jsx("div",{className:"block-label",children:t.name}),t.weights.map((p,N)=>e.jsx("div",{className:"heatmap-cell",style:{backgroundColor:`hsl(${p*120}, 70%, 30%)`},title:`Weight: ${p.toFixed(3)}`,children:p.toFixed(2)},N))]},n))]})]})},m=D();return e.jsxs("div",{className:"karcher-config",children:[e.jsxs("div",{className:"config-header",children:[e.jsx("h2",{children:"Karcher Mean Configuration"}),e.jsx("p",{children:"Create JSON configuration for karcher_mean_with_json function"})]}),e.jsxs("div",{className:"config-content",children:[e.jsxs("div",{className:"controls-section",children:[e.jsxs("div",{className:"basic-controls",children:[e.jsxs("div",{className:"control-group",children:[e.jsx("label",{htmlFor:"num-models",children:"Number of Models (2-10):"}),e.jsxs("div",{className:"slider-with-value",children:[e.jsx("input",{id:"num-models",type:"range",min:"2",max:"10",value:i,onChange:s=>w(parseInt(s.target.value))}),e.jsx("span",{className:"slider-value",children:i})]})]}),e.jsx("div",{className:"control-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:_,onChange:s=>q(s.target.checked)}),e.jsx("span",{children:"Show All Block Settings"})]})}),e.jsx("div",{className:"control-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:F,onChange:s=>H(s.target.checked)}),e.jsx("span",{children:"Show Advanced Settings"})]})})]}),$(),F&&e.jsxs("div",{className:"advanced-settings",children:[e.jsx("h3",{children:"Advanced Settings"}),e.jsxs("div",{className:"advanced-controls",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"max-iter",children:"Max Iterations:"}),e.jsx("input",{id:"max-iter",type:"number",value:b.max_iter,onChange:s=>B({...b,max_iter:parseInt(s.target.value)}),min:"1"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"tol",children:"Tolerance:"}),e.jsx("input",{id:"tol",type:"number",value:b.tol,onChange:s=>B({...b,tol:parseFloat(s.target.value)}),step:"1e-6",min:"1e-10"})]})]})]}),G(),e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{onClick:se,className:"reset-btn",children:"Reset to Defaults"}),e.jsx(ce,{text:m,label:"Copy JSON"})]})]}),e.jsxs("div",{className:"output-section",children:[d(),e.jsx(me,{json:m})]})]})]})}const ie=[{name:"IN",label:"Input Blocks",subBlocks:Array.from({length:9},(i,w)=>`IN${w.toString().padStart(2,"0")}`)},{name:"M",label:"Middle Block",subBlocks:["M00"]},{name:"OUT",label:"Output Blocks",subBlocks:Array.from({length:9},(i,w)=>`OUT${w.toString().padStart(2,"0")}`)},{name:"CLIP_L",label:"CLIP L",subBlocks:[]},{name:"CLIP_G",label:"CLIP G",subBlocks:[]},{name:"time_embed",label:"Time Embed",subBlocks:[]},{name:"label_emb",label:"Label Embed",subBlocks:[]}];function ze(){const[i,w]=c.useState(2),[j,A]=c.useState([.5,.5]),[b,B]=c.useState("0.5,0.5"),[F,H]=c.useState(!1),[_,q]=c.useState({}),[y,P]=c.useState({});c.useEffect(()=>{const d=Array(i).fill(1/i);A(d);const m=d.map(n=>n.toFixed(3)).join(",");B(m);const s={},t={};ie.forEach(n=>{n.subBlocks.length>0&&n.subBlocks.forEach(p=>{s[p]=m,t[p]=!1}),s[n.name]=m,t[n.name]=!1}),q(s),P(t)},[i]),c.useEffect(()=>{const d=j.map(m=>m.toFixed(3)).join(",");B(d)},[j]);const C=(d,m)=>{const s=[...j];s[d]=parseFloat(m),A(s)},K=()=>{const d=j.reduce((s,t)=>s+t,0);if(d===0)return;const m=j.map(s=>s/d);A(m)},U=()=>{const d={global:b};if(F){const m=[];ie.forEach(t=>{t.subBlocks.forEach(n=>{const p=_[t.name]||b;y[n]&&_[n]!==p&&_[n]!==b&&m.push({name:n,weight:_[n]})})});const s=[];ie.forEach(t=>{y[t.name]&&_[t.name]!==b&&s.push({name:t.name,weight:_[t.name]})}),[...m,...s].forEach(t=>{d[t.name]=t.weight})}return JSON.stringify(d,null,2)},[Y,D]=c.useState(["Model 1","Model 2"]);c.useEffect(()=>{const d=Array.from({length:i},(m,s)=>`Model ${s+1}`);D(d)},[i]);const I=(d,m)=>{const s=[...Y];s[d]=m||`Model ${d+1}`,D(s)},J=(d,m)=>{q(s=>({...s,[d]:m}))},ee=d=>{P(m=>({...m,[d]:!m[d]}))},E=d=>{const s=(_[d]||b).split(",").map(N=>parseFloat(N)||0),t=s.reduce((N,V)=>N+V,0);if(t===0)return;const p=s.map(N=>N/t).map(N=>N.toFixed(3)).join(",");J(d,p)},Z=()=>{const d=Array(i).fill(1/i);A(d);const m=d.map(n=>n.toFixed(3)).join(",");B(m);const s={},t={};ie.forEach(n=>{n.subBlocks.length>0&&n.subBlocks.forEach(p=>{s[p]=m,t[p]=!1}),s[n.name]=m,t[n.name]=!1}),q(s),P(t)},L=()=>e.jsxs("div",{className:"model-weights-section",children:[e.jsx("h3",{children:"Model Weights"}),e.jsx("div",{className:"model-sliders",children:j.map((d,m)=>e.jsxs("div",{className:"model-slider-container",children:[e.jsxs("div",{className:"slider-label-row",children:[e.jsx("input",{type:"text",value:Y[m],onChange:s=>I(m,s.target.value),className:"model-name-input"}),e.jsxs("span",{children:[(d*100).toFixed(1),"%"]})]}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:d,onChange:s=>C(m,s.target.value),className:"slider"}),e.jsx("div",{className:"weight-value",children:d.toFixed(3)})]},m))}),e.jsx("div",{className:"normalize-row",children:e.jsx("button",{onClick:K,className:"normalize-btn",children:"Normalize Global Weights"})})]}),se=()=>F?e.jsxs("div",{className:"block-controls",children:[e.jsx("h3",{children:"Block Weights"}),e.jsx("div",{className:"blocks-grid",children:ie.map(d=>e.jsxs("div",{className:"block-group",children:[e.jsxs("div",{className:"group-header",children:[e.jsxs("div",{className:"group-label",children:[e.jsx("input",{type:"checkbox",checked:y[d.name]||!1,onChange:()=>ee(d.name),id:`group-${d.name}`}),e.jsx("label",{htmlFor:`group-${d.name}`,children:d.label})]}),e.jsxs("div",{className:"group-input-row",children:[e.jsx("input",{type:"text",value:_[d.name]||b,onChange:m=>J(d.name,m.target.value),disabled:!y[d.name],placeholder:"Comma separated weights",className:"weights-input"}),e.jsx("button",{onClick:()=>E(d.name),disabled:!y[d.name],className:"normalize-btn small",children:"Normalize"})]})]}),d.subBlocks.length>0&&e.jsx("div",{className:"sub-blocks",children:d.subBlocks.map(m=>e.jsxs("div",{className:"sub-block",children:[e.jsxs("div",{className:"sub-block-content",children:[e.jsx("input",{type:"checkbox",checked:y[m]||!1,onChange:()=>ee(m),id:`sub-${m}`}),e.jsx("label",{htmlFor:`sub-${m}`,children:m})]}),e.jsxs("div",{className:"sub-block-input-row",children:[e.jsx("input",{type:"text",value:_[m]||_[d.name]||b,onChange:s=>J(m,s.target.value),disabled:!y[m],placeholder:`Weights for ${m}`,className:"weights-input"}),e.jsx("button",{onClick:()=>E(m),disabled:!y[m],className:"normalize-btn small",children:"Normalize"})]})]},m))})]},d.name))})]}):null,$=()=>{const d=[];if(ie.forEach(m=>{if(m.subBlocks.length>0&&m.subBlocks.forEach(s=>{if(y[s]){const t=_[s]||b,n=t?t.split(",").map(p=>parseFloat(p)||0):Array(i).fill(0);d.push({name:s,weights:n,type:"specific"})}}),y[m.name]){const s=_[m.name]||b,t=s?s.split(",").map(n=>parseFloat(n)||0):Array(i).fill(0);d.push({name:m.name,weights:t,type:"group"})}}),d.length===0){const m=b?b.split(",").map(s=>parseFloat(s)||0):Array(i).fill(0);d.push({name:"global",weights:m,type:"global"})}return e.jsxs("div",{className:"heatmap",children:[e.jsx("h3",{children:"Block Weights Visualization"}),e.jsxs("div",{className:"heatmap-grid",children:[e.jsxs("div",{className:"heatmap-headers",children:[e.jsx("div",{className:"block-label",children:"Block"}),Array.from({length:i}).map((m,s)=>e.jsx("div",{className:"model-header",children:Y[s]||`Model ${s+1}`},s))]}),d.map((m,s)=>e.jsxs("div",{className:"heatmap-row",children:[e.jsx("div",{className:"block-label",children:m.name}),m.weights.map((t,n)=>e.jsx("div",{className:"heatmap-cell",style:{backgroundColor:`hsl(${t*120}, 70%, 30%)`},title:`Weight: ${t.toFixed(3)}`,children:t.toFixed(2)},n))]},s))]})]})},G=U();return e.jsxs("div",{className:"weight-sum-config",children:[e.jsxs("div",{className:"config-header",children:[e.jsx("h2",{children:"Weight Sum Configuration"}),e.jsx("p",{children:"Create JSON configuration for weight_sum_with_json function"})]}),e.jsxs("div",{className:"config-content",children:[e.jsxs("div",{className:"controls-section",children:[e.jsxs("div",{className:"basic-controls",children:[e.jsxs("div",{className:"control-group",children:[e.jsx("label",{htmlFor:"num-models",children:"Number of Models (2-10):"}),e.jsxs("div",{className:"slider-with-value",children:[e.jsx("input",{id:"num-models",type:"range",min:"2",max:"10",value:i,onChange:d=>w(parseInt(d.target.value))}),e.jsx("span",{className:"slider-value",children:i})]})]}),e.jsx("div",{className:"control-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:F,onChange:d=>H(d.target.checked)}),e.jsx("span",{children:"Show All Block Settings"})]})})]}),L(),se(),e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{onClick:Z,className:"reset-btn",children:"Reset to Defaults"}),e.jsx(ce,{text:G,label:"Copy JSON"})]})]}),e.jsxs("div",{className:"output-section",children:[$(),e.jsx(me,{json:G})]})]})]})}const oe=[{name:"IN",label:"Input Blocks",subBlocks:Array.from({length:9},(i,w)=>`IN${w.toString().padStart(2,"0")}`)},{name:"M",label:"Middle Block",subBlocks:["M00"]},{name:"OUT",label:"Output Blocks",subBlocks:Array.from({length:9},(i,w)=>`OUT${w.toString().padStart(2,"0")}`)},{name:"CLIP_L",label:"CLIP L",subBlocks:[]},{name:"CLIP_G",label:"CLIP G",subBlocks:[]},{name:"time_embed",label:"Time Embed",subBlocks:[]},{name:"label_emb",label:"Label Embed",subBlocks:[]}];function De(){const[i,w]=c.useState(2),[j,A]=c.useState([1,1]),[b,B]=c.useState(1),[F,H]=c.useState(1e-6),[_,q]=c.useState(1e-6),[y,P]=c.useState(100),[C,K]=c.useState(1e-20),[U,Y]=c.useState(!1),[D,I]=c.useState(!1),[J,ee]=c.useState(!1),[E,Z]=c.useState("1.0,1.0"),[L,se]=c.useState("0.2,0.2"),[$,G]=c.useState({}),[d,m]=c.useState(!1),[s,t]=c.useState(!1),[n,p]=c.useState(!1),[N,V]=c.useState(!1),[R,le]=c.useState(!1),[o,x]=c.useState({}),[u,h]=c.useState({}),[M,z]=c.useState(["Model 1","Model 2"]);c.useEffect(()=>{const a=Array(i).fill(1);A(a);const r=a.map(k=>k.toFixed(1)).join(","),l=Array(i).fill(.2).join(",");Z(r),se(l);const g={},v={};oe.forEach(k=>{k.subBlocks.length>0&&k.subBlocks.forEach(S=>{g[S]={weights:r,densities:l},v[S]=!1}),g[k.name]={weights:r,densities:l},v[k.name]=!1}),x(g),h(v)},[i]),c.useEffect(()=>{const a=Array.from({length:i},(r,l)=>`Model ${l+1}`);z(a)},[i]),c.useEffect(()=>{const a=j.map(r=>r.toFixed(3)).join(",");Z(a),G(r=>{const l={...r};return delete l["global-weights"],l})},[j]);const T=(a,r)=>a!==void 0?a:r,O=a=>{if(!a.trim())return"Densities cannot be empty";const r=a.split(",").map(l=>l.trim());if(r.length!==i)return`Must have exactly ${i} density values (one per model)`;for(let l=0;l<r.length;l++){const g=parseFloat(r[l]);if(isNaN(g))return`Invalid density value at position ${l+1}: "${r[l]}"`;if(g<0||g>1)return`Density at position ${l+1} must be between 0.0 and 1.0, got ${g}`}return null},X=a=>{if(!a.trim())return"Weights cannot be empty";const r=a.split(",").map(l=>l.trim());if(r.length!==i)return`Must have exactly ${i} weight values (one per model)`;for(let l=0;l<r.length;l++){const g=parseFloat(r[l]);if(isNaN(g))return`Invalid weight value at position ${l+1}: "${r[l]}"`}return null},Ne=(a,r)=>{const l=[...j];l[a]=parseFloat(r),A(l)},ye=()=>{const a=j.reduce((l,g)=>l+g,0);if(a===0)return;const r=j.map(l=>l/a);A(r)},Q=(a,r)=>{x(l=>({...l,[a]:{...l[a],...r}}))},be=a=>{h(r=>({...r,[a]:!r[a]}))},fe=a=>{const g=(o[a]||{weights:E}).weights.split(",").map(f=>parseFloat(f)||0),v=g.reduce((f,ae)=>f+ae,0);if(v===0)return;const S=g.map(f=>f/v).map(f=>f.toFixed(3)).join(",");Q(a,{weights:S})},ke=(a,r)=>{const l=[...M];l[a]=r||`Model ${a+1}`,z(l)},we=c.useMemo(()=>{const a={lambda:b,cos_eps:F,eps:_,maxiter:y,ftol:C,vote_sgn:U,apply_stock:D,apply_median:J,global:{weights:E,densities:L}};d!==U&&(a.global.vote_sgn=d),s!==D&&(a.global.apply_stock=s),n!==J&&(a.global.apply_median=n);const r=d!==U?d:U,l=s!==D?s:D,g=n!==J?n:J;if(R){const v=[];oe.forEach(S=>{const f=o[S.name]||{weights:E,densities:L},ae=T(f.vote_sgn,r),pe=T(f.apply_stock,l),ge=T(f.apply_median,g);S.subBlocks.forEach(re=>{const W=o[re]||{weights:f.weights,densities:f.densities},ue=T(W.vote_sgn,ae),te=T(W.apply_stock,pe),ve=T(W.apply_median,ge),$e=W.weights!==f.weights&&W.weights!==E,Me=W.densities!==f.densities&&W.densities!==L,We=W.vote_sgn!==void 0&&W.vote_sgn!==ue||W.apply_stock!==void 0&&W.apply_stock!==te||W.apply_median!==void 0&&W.apply_median!==ve;if(u[re]&&($e||Me||We)){const xe={weights:W.weights,densities:W.densities};W.vote_sgn!==void 0&&W.vote_sgn!==ue&&(xe.vote_sgn=W.vote_sgn),W.apply_stock!==void 0&&W.apply_stock!==te&&(xe.apply_stock=W.apply_stock),W.apply_median!==void 0&&W.apply_median!==ve&&(xe.apply_median=W.apply_median),v.push({name:re,config:xe})}})});const k=[];oe.forEach(S=>{const f=o[S.name]||{weights:E,densities:L},ae=T(f.vote_sgn,r),pe=T(f.apply_stock,l),ge=T(f.apply_median,g),re=f.weights!==E,W=f.densities!==L,ue=f.vote_sgn!==void 0&&f.vote_sgn!==ae||f.apply_stock!==void 0&&f.apply_stock!==pe||f.apply_median!==void 0&&f.apply_median!==ge;if(u[S.name]&&(re||W||ue)){const te={weights:f.weights,densities:f.densities};f.vote_sgn!==void 0&&f.vote_sgn!==ae&&(te.vote_sgn=f.vote_sgn),f.apply_stock!==void 0&&f.apply_stock!==pe&&(te.apply_stock=f.apply_stock),f.apply_median!==void 0&&f.apply_median!==ge&&(te.apply_median=f.apply_median),k.push({name:S.name,config:te})}}),[...v,...k].forEach(S=>{a[S.name]=S.config})}return JSON.stringify(a,null,2)},[b,F,_,y,C,U,D,J,E,L,d,s,n,R,u,o,i]),Se=()=>{const a=Array(i).fill(1);A(a);const r=a.map(k=>k.toFixed(1)).join(","),l=Array(i).fill(.2).join(",");Z(r),se(l),G({}),B(1),H(1e-6),q(1e-6),P(100),K(1e-20),Y(!1),I(!1),ee(!1),m(!1),t(!1),p(!1);const g={},v={};oe.forEach(k=>{k.subBlocks.length>0&&k.subBlocks.forEach(S=>{g[S]={weights:r,densities:l},v[S]=!1}),g[k.name]={weights:r,densities:l},v[k.name]=!1}),x(g),h(v)},_e=()=>e.jsxs("div",{className:"model-weights-section",children:[e.jsx("h3",{children:"Model Weights"}),e.jsx("div",{className:"model-sliders",children:j.map((a,r)=>e.jsxs("div",{className:"model-slider-container",children:[e.jsxs("div",{className:"slider-label-row",children:[e.jsx("input",{type:"text",value:M[r],onChange:l=>ke(r,l.target.value),className:"model-name-input"}),e.jsxs("span",{children:[(a*100).toFixed(1),"%"]})]}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:a,onChange:l=>Ne(r,l.target.value),className:"slider"}),e.jsx("div",{className:"weight-value",children:a.toFixed(3)})]},r))}),e.jsx("div",{className:"normalize-row",children:e.jsx("button",{onClick:ye,className:"normalize-btn",children:"Normalize Global Weights"})})]}),Ce=()=>e.jsxs("div",{className:"global-settings-section",children:[e.jsx("h3",{children:"Global Settings"}),e.jsxs("div",{className:"global-controls",children:[e.jsxs("div",{className:"control-group",children:[e.jsx("label",{htmlFor:"lambda",children:"Lambda (scaling parameter):"}),e.jsx("input",{id:"lambda",type:"number",value:b,onChange:a=>B(parseFloat(a.target.value)),step:"0.1",className:"lambda-input"})]}),e.jsxs("div",{className:"control-group",children:[e.jsx("label",{htmlFor:"global-densities",children:"Global Densities (0.0-1.0):"}),e.jsx("input",{id:"global-densities",type:"text",value:L,onChange:a=>{const r=a.target.value;se(r);const l=O(r);G(l?g=>({...g,"global-densities":l}):g=>{const v={...g};return delete v["global-densities"],v})},placeholder:"Comma separated densities",className:`densities-input ${$["global-densities"]?"error":""}`}),$["global-densities"]&&e.jsx("small",{style:{color:"var(--error-color, #e74c3c)",fontSize:"0.75rem"},children:$["global-densities"]}),!$["global-densities"]&&e.jsx("small",{style:{color:"var(--text-secondary, #bdc3c7)",fontSize:"0.75rem"},children:"Density values should be between 0.0 and 1.0 for each model"})]}),e.jsxs("div",{className:"flags-group",children:[e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:U,onChange:a=>Y(a.target.checked)}),e.jsx("span",{children:"vote_sgn (root level)"})]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:D,onChange:a=>I(a.target.checked)}),e.jsx("span",{children:"apply_stock (root level)"})]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:J,onChange:a=>ee(a.target.checked)}),e.jsx("span",{children:"apply_median (root level)"})]})]}),e.jsxs("div",{className:"flags-group",children:[e.jsx("h4",{style:{margin:"0.5rem 0",fontSize:"0.85rem",color:"var(--text-primary, #ecf0f1)"},children:"Global Block Flags:"}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:d,onChange:a=>m(a.target.checked)}),e.jsx("span",{children:"vote_sgn (global)"})]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:s,onChange:a=>{a.target.checked&&n?(t(!0),p(!1)):t(a.target.checked)},disabled:n===!0}),e.jsx("span",{children:"apply_stock (global)"}),n&&e.jsx("small",{style:{color:"var(--text-secondary, #bdc3c7)",fontSize:"0.7rem",marginLeft:"0.25rem"},children:"(disabled when apply_median is enabled)"})]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:n,onChange:a=>{a.target.checked&&s?(p(!0),t(!1)):p(a.target.checked)}}),e.jsx("span",{children:"apply_median (global)"}),n&&s&&e.jsx("small",{style:{color:"var(--warning-color, #f39c12)",fontSize:"0.7rem",marginLeft:"0.25rem"},children:"(has priority over apply_stock)"})]})]})]})]}),Fe=()=>R?e.jsxs("div",{className:"block-controls",children:[e.jsx("h3",{children:"Block Settings"}),e.jsx("div",{className:"blocks-grid",children:oe.map(a=>{const r=o[a.name]||{weights:E,densities:L};return e.jsxs("div",{className:"block-group",children:[e.jsx("div",{className:"group-header",children:e.jsxs("div",{className:"group-label",children:[e.jsx("input",{type:"checkbox",checked:u[a.name]||!1,onChange:()=>be(a.name),id:`group-${a.name}`}),e.jsx("label",{htmlFor:`group-${a.name}`,children:a.label})]})}),e.jsxs("div",{className:"group-controls",children:[e.jsxs("div",{className:"control-group",children:[e.jsx("label",{htmlFor:`weights-${a.name}`,children:"Weights:"}),e.jsxs("div",{className:"input-with-button",children:[e.jsx("input",{id:`weights-${a.name}`,type:"text",value:r.weights,onChange:l=>{const g=l.target.value;Q(a.name,{weights:g});const v=X(g);G(v?k=>({...k,[`weights-${a.name}`]:v}):k=>{const S={...k};return delete S[`weights-${a.name}`],S})},disabled:!u[a.name],placeholder:"Comma separated weights",className:`weights-input ${$[`weights-${a.name}`]?"error":""}`}),e.jsx("button",{onClick:()=>fe(a.name),disabled:!u[a.name],className:"normalize-btn small",children:"Normalize"})]})]}),e.jsxs("div",{className:"control-group",children:[e.jsx("label",{htmlFor:`densities-${a.name}`,children:"Densities (0.0-1.0):"}),e.jsx("input",{id:`densities-${a.name}`,type:"text",value:r.densities,onChange:l=>{const g=l.target.value;Q(a.name,{densities:g});const v=O(g);G(v?k=>({...k,[`densities-${a.name}`]:v}):k=>{const S={...k};return delete S[`densities-${a.name}`],S})},disabled:!u[a.name],placeholder:"Comma separated densities",className:`densities-input ${$[`densities-${a.name}`]?"error":""}`}),$[`densities-${a.name}`]&&e.jsx("small",{style:{color:"var(--error-color, #e74c3c)",fontSize:"0.75rem"},children:$[`densities-${a.name}`]}),$[`weights-${a.name}`]&&e.jsx("small",{style:{color:"var(--error-color, #e74c3c)",fontSize:"0.75rem"},children:$[`weights-${a.name}`]})]}),e.jsxs("div",{className:"flags-group",children:[e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:r.vote_sgn||!1,onChange:l=>Q(a.name,{vote_sgn:l.target.checked}),disabled:!u[a.name]}),e.jsx("span",{children:"vote_sgn"})]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:r.apply_stock||!1,onChange:l=>{l.target.checked&&r.apply_median?Q(a.name,{apply_stock:!0,apply_median:!1}):Q(a.name,{apply_stock:l.target.checked})},disabled:!u[a.name]||r.apply_median===!0}),e.jsx("span",{children:"apply_stock"}),r.apply_median&&e.jsx("small",{style:{color:"var(--text-secondary, #bdc3c7)",fontSize:"0.7rem",marginLeft:"0.25rem"},children:"(disabled when apply_median is enabled)"})]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:r.apply_median||!1,onChange:l=>{l.target.checked&&r.apply_stock?Q(a.name,{apply_median:!0,apply_stock:!1}):Q(a.name,{apply_median:l.target.checked})},disabled:!u[a.name]}),e.jsx("span",{children:"apply_median"}),r.apply_median&&r.apply_stock&&e.jsx("small",{style:{color:"var(--warning-color, #f39c12)",fontSize:"0.7rem",marginLeft:"0.25rem"},children:"(has priority over apply_stock)"})]})]})]}),a.subBlocks.length>0&&e.jsx("div",{className:"sub-blocks",children:a.subBlocks.map(l=>{const g=o[l]||{weights:r.weights,densities:r.densities};return e.jsxs("div",{className:"sub-block",children:[e.jsxs("div",{className:"sub-block-content",children:[e.jsx("input",{type:"checkbox",checked:u[l]||!1,onChange:()=>be(l),id:`sub-${l}`}),e.jsx("label",{htmlFor:`sub-${l}`,children:l})]}),e.jsxs("div",{className:"sub-block-controls",children:[e.jsxs("div",{className:"control-group",children:[e.jsx("label",{htmlFor:`weights-${l}`,children:"Weights:"}),e.jsxs("div",{className:"input-with-button",children:[e.jsx("input",{id:`weights-${l}`,type:"text",value:g.weights,onChange:v=>{const k=v.target.value;Q(l,{weights:k});const S=X(k);G(S?f=>({...f,[`weights-${l}`]:S}):f=>{const ae={...f};return delete ae[`weights-${l}`],ae})},disabled:!u[l],placeholder:`Weights for ${l}`,className:`weights-input ${$[`weights-${l}`]?"error":""}`}),e.jsx("button",{onClick:()=>fe(l),disabled:!u[l],className:"normalize-btn small",children:"Normalize"})]})]}),e.jsxs("div",{className:"control-group",children:[e.jsx("label",{htmlFor:`densities-${l}`,children:"Densities (0.0-1.0):"}),e.jsx("input",{id:`densities-${l}`,type:"text",value:g.densities,onChange:v=>{const k=v.target.value;Q(l,{densities:k});const S=O(k);G(S?f=>({...f,[`densities-${l}`]:S}):f=>{const ae={...f};return delete ae[`densities-${l}`],ae})},disabled:!u[l],placeholder:`Densities for ${l}`,className:`densities-input ${$[`densities-${l}`]?"error":""}`}),$[`densities-${l}`]&&e.jsx("small",{style:{color:"var(--error-color, #e74c3c)",fontSize:"0.75rem"},children:$[`densities-${l}`]}),$[`weights-${l}`]&&e.jsx("small",{style:{color:"var(--error-color, #e74c3c)",fontSize:"0.75rem"},children:$[`weights-${l}`]})]}),e.jsxs("div",{className:"flags-group",children:[e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:g.vote_sgn||!1,onChange:v=>Q(l,{vote_sgn:v.target.checked}),disabled:!u[l]}),e.jsx("span",{children:"vote_sgn"})]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:g.apply_stock||!1,onChange:v=>{v.target.checked&&g.apply_median?Q(l,{apply_stock:!0,apply_median:!1}):Q(l,{apply_stock:v.target.checked})},disabled:!u[l]||g.apply_median===!0}),e.jsx("span",{children:"apply_stock"}),g.apply_median&&e.jsx("small",{style:{color:"var(--text-secondary, #bdc3c7)",fontSize:"0.7rem",marginLeft:"0.25rem"},children:"(disabled when apply_median is enabled)"})]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:g.apply_median||!1,onChange:v=>{v.target.checked&&g.apply_stock?Q(l,{apply_median:!0,apply_stock:!1}):Q(l,{apply_median:v.target.checked})},disabled:!u[l]}),e.jsx("span",{children:"apply_median"}),g.apply_median&&g.apply_stock&&e.jsx("small",{style:{color:"var(--warning-color, #f39c12)",fontSize:"0.7rem",marginLeft:"0.25rem"},children:"(has priority over apply_stock)"})]})]})]})]},l)})})]},a.name)})})]}):null,Ee=()=>{const a=[];if(oe.forEach(r=>{if(r.subBlocks.length>0&&r.subBlocks.forEach(l=>{if(u[l]){const g=o[l]||{weights:E,densities:L},v=g.weights?g.weights.split(",").map(S=>parseFloat(S)||0):Array(i).fill(0),k=g.densities?g.densities.split(",").map(S=>parseFloat(S)||0):Array(i).fill(0);a.push({name:l,weights:v,densities:k,type:"specific"})}}),u[r.name]){const l=o[r.name]||{weights:E,densities:L},g=l.weights?l.weights.split(",").map(k=>parseFloat(k)||0):Array(i).fill(0),v=l.densities?l.densities.split(",").map(k=>parseFloat(k)||0):Array(i).fill(0);a.push({name:r.name,weights:g,densities:v,type:"group"})}}),a.length===0){const r=E?E.split(",").map(g=>parseFloat(g)||0):Array(i).fill(0),l=L?L.split(",").map(g=>parseFloat(g)||0):Array(i).fill(0);a.push({name:"global",weights:r,densities:l,type:"global"})}return e.jsxs("div",{className:"heatmap",children:[e.jsx("h3",{children:"Block Weights & Densities Visualization"}),e.jsxs("div",{className:"heatmap-grid",children:[e.jsxs("div",{className:"heatmap-headers",children:[e.jsx("div",{className:"block-label",children:"Block"}),Array.from({length:i}).map((r,l)=>e.jsx("div",{className:"model-header",children:M[l]||`Model ${l+1}`},l))]}),a.map((r,l)=>e.jsxs("div",{className:"heatmap-row",children:[e.jsx("div",{className:"block-label",children:r.name}),r.weights.map((g,v)=>e.jsxs("div",{className:"heatmap-cell",style:{backgroundColor:`hsl(${g*120}, 70%, 30%)`},title:`Weight: ${g.toFixed(3)}, Density: ${r.densities[v].toFixed(3)}`,children:[e.jsx("div",{children:g.toFixed(2)}),e.jsxs("div",{style:{fontSize:"0.65rem",opacity:.8},children:["D:",r.densities[v].toFixed(2)]})]},v))]},l))]})]})},je=we;let he=null;try{JSON.parse(je)}catch(a){he=a instanceof Error?a.message:"Invalid JSON"}return e.jsxs("div",{className:"ties-config",children:[e.jsxs("div",{className:"config-header",children:[e.jsx("h2",{children:"TIES Merging Configuration"}),e.jsx("p",{children:"Create JSON configuration for ties_merging_with_json function"})]}),e.jsxs("div",{className:"config-content",children:[e.jsxs("div",{className:"controls-section",children:[e.jsxs("div",{className:"basic-controls",children:[e.jsxs("div",{className:"control-group",children:[e.jsx("label",{htmlFor:"num-models",children:"Number of Models (2-10):"}),e.jsxs("div",{className:"slider-with-value",children:[e.jsx("input",{id:"num-models",type:"range",min:"2",max:"10",value:i,onChange:a=>w(parseInt(a.target.value))}),e.jsx("span",{className:"slider-value",children:i})]})]}),e.jsx("div",{className:"control-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:R,onChange:a=>le(a.target.checked)}),e.jsx("span",{children:"Show All Block Settings"})]})}),e.jsx("div",{className:"control-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:N,onChange:a=>V(a.target.checked)}),e.jsx("span",{children:"Show Advanced Settings"})]})})]}),Ce(),_e(),N&&e.jsxs("div",{className:"advanced-settings",children:[e.jsx("h3",{children:"Advanced Settings"}),e.jsxs("div",{className:"advanced-controls",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"cos-eps",children:"cos_eps (Model Stock):"}),e.jsx("input",{id:"cos-eps",type:"number",value:F,onChange:a=>H(parseFloat(a.target.value)),step:"1e-7",min:"1e-10"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"eps",children:"eps (Geometric Median):"}),e.jsx("input",{id:"eps",type:"number",value:_,onChange:a=>q(parseFloat(a.target.value)),step:"1e-7",min:"1e-10"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"maxiter",children:"maxiter (Geometric Median):"}),e.jsx("input",{id:"maxiter",type:"number",value:y,onChange:a=>P(parseInt(a.target.value)),min:"1"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"ftol",children:"ftol (Geometric Median):"}),e.jsx("input",{id:"ftol",type:"number",value:C,onChange:a=>K(parseFloat(a.target.value)),step:"1e-21",min:"1e-30"})]})]})]}),Fe(),e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{onClick:Se,className:"reset-btn",children:"Reset to Defaults"}),e.jsx(ce,{text:je,label:"Copy JSON",disabled:he!==null||Object.keys($).length>0})]}),he&&e.jsxs("div",{style:{color:"var(--error-color, #e74c3c)",fontSize:"0.85rem",marginTop:"0.5rem"},children:["JSON Error: ",he]})]}),e.jsxs("div",{className:"output-section",children:[Ee(),e.jsx(me,{json:je})]})]})]})}function Le(){const[i,w]=c.useState(2),[j,A]=c.useState([1,1]),[b,B]=c.useState(1),[F,H]=c.useState(.25),[_,q]=c.useState(!1),[y,P]=c.useState(!1),[C,K]=c.useState(!1),[U,Y]=c.useState(!1),[D,I]=c.useState(1e-6),[J,ee]=c.useState(1e-6),[E,Z]=c.useState(100),[L,se]=c.useState(1e-20),[$,G]=c.useState(["LoRA 1","LoRA 2"]),[d,m]=c.useState({});c.useEffect(()=>{const h=Array(i).fill(1);A(h)},[i]),c.useEffect(()=>{const h=Array.from({length:i},(M,z)=>`LoRA ${z+1}`);G(h)},[i]);const s=(h,M)=>{const z=[...j];z[h]=parseFloat(M),A(z)},t=()=>{const h=j.reduce((z,T)=>z+T,0);if(h===0)return;const M=j.map(z=>z/h);A(M)},n=(h,M)=>{const z=[...$];z[h]=M||`LoRA ${h+1}`,G(z)},p=h=>isNaN(h)?"Density must be a number":h<0||h>1?`Density must be between 0.0 and 1.0, got ${h}`:null,N=c.useMemo(()=>{const h={lambda:b,weights:j.map(M=>M.toFixed(3)).join(","),density:F,vote_sgn:_,apply_stock:y,apply_median:C};return D!==1e-6&&(h.cos_eps=D),J!==1e-6&&(h.eps=J),E!==100&&(h.maxiter=E),L!==1e-20&&(h.ftol=L),JSON.stringify(h,null,2)},[b,j,F,_,y,C,D,J,E,L]),V=()=>{const h=Array(i).fill(1);A(h),H(.25),B(1),q(!1),P(!1),K(!1),I(1e-6),ee(1e-6),Z(100),se(1e-20),m({})},R=()=>e.jsxs("div",{className:"model-weights-section",children:[e.jsx("h3",{children:"LoRA Weights"}),e.jsx("div",{className:"model-sliders",children:j.map((h,M)=>e.jsxs("div",{className:"model-slider-container",children:[e.jsxs("div",{className:"slider-label-row",children:[e.jsx("input",{type:"text",value:$[M],onChange:z=>n(M,z.target.value),className:"model-name-input"}),e.jsxs("span",{children:[(h*100).toFixed(1),"%"]})]}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:h,onChange:z=>s(M,z.target.value),className:"slider"}),e.jsx("div",{className:"weight-value",children:h.toFixed(3)})]},M))}),e.jsx("div",{className:"normalize-row",children:e.jsx("button",{onClick:t,className:"normalize-btn",children:"Normalize Weights"})})]}),le=()=>e.jsxs("div",{className:"global-settings-section",children:[e.jsx("h3",{children:"Global Settings"}),e.jsxs("div",{className:"global-controls",children:[e.jsxs("div",{className:"control-group",children:[e.jsx("label",{htmlFor:"lambda",children:"Lambda (scaling parameter):"}),e.jsx("input",{id:"lambda",type:"number",value:b,onChange:h=>B(parseFloat(h.target.value)),step:"0.1",className:"lambda-input"})]}),e.jsxs("div",{className:"control-group",children:[e.jsx("label",{htmlFor:"density",children:"Global Density (0.0-1.0):"}),e.jsxs("div",{className:"slider-with-value",children:[e.jsx("input",{id:"density",type:"range",min:"0",max:"1",step:"0.01",value:F,onChange:h=>{const M=parseFloat(h.target.value);H(M);const z=p(M);m(z?T=>({...T,density:z}):T=>{const O={...T};return delete O.density,O})},className:"slider"}),e.jsxs("span",{className:"slider-value",children:[(F*100).toFixed(0),"%"]})]}),e.jsx("div",{className:"density-value",children:F.toFixed(3)}),d.density&&e.jsx("small",{style:{color:"var(--error-color, #e74c3c)",fontSize:"0.75rem"},children:d.density}),!d.density&&e.jsxs("small",{style:{color:"var(--text-secondary, #bdc3c7)",fontSize:"0.75rem"},children:["Density controls TRIM step: top-",Math.round(F*100),"% of parameters by magnitude"]})]}),e.jsxs("div",{className:"flags-group",children:[e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:_,onChange:h=>q(h.target.checked)}),e.jsx("span",{children:"vote_sgn"})]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:y,onChange:h=>{h.target.checked&&C?(P(!0),K(!1)):P(h.target.checked)},disabled:C===!0}),e.jsx("span",{children:"apply_stock"}),C&&e.jsx("small",{style:{color:"var(--text-secondary, #bdc3c7)",fontSize:"0.7rem",marginLeft:"0.25rem"},children:"(disabled when apply_median is enabled)"})]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:C,onChange:h=>{h.target.checked&&y?(K(!0),P(!1)):K(h.target.checked)}}),e.jsx("span",{children:"apply_median"}),C&&y&&e.jsx("small",{style:{color:"var(--warning-color, #f39c12)",fontSize:"0.7rem",marginLeft:"0.25rem"},children:"(has priority over apply_stock)"})]})]})]})]}),o=N;let x=null;try{JSON.parse(o)}catch(h){x=h instanceof Error?h.message:"Invalid JSON"}const u=y&&C;return e.jsxs("div",{className:"ties-lora-config",children:[e.jsxs("div",{className:"config-header",children:[e.jsx("h2",{children:"TIES LoRA Merging Configuration"}),e.jsx("p",{children:"Create JSON configuration for ties_lora_with_json function"})]}),e.jsxs("div",{className:"config-content",children:[e.jsxs("div",{className:"controls-section",children:[e.jsxs("div",{className:"basic-controls",children:[e.jsxs("div",{className:"control-group",children:[e.jsx("label",{htmlFor:"num-loras",children:"Number of LoRA (2-10):"}),e.jsxs("div",{className:"slider-with-value",children:[e.jsx("input",{id:"num-loras",type:"range",min:"2",max:"10",value:i,onChange:h=>w(parseInt(h.target.value))}),e.jsx("span",{className:"slider-value",children:i})]})]}),e.jsx("div",{className:"control-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:U,onChange:h=>Y(h.target.checked)}),e.jsx("span",{children:"Show Advanced Settings"})]})})]}),le(),R(),U&&e.jsxs("div",{className:"advanced-settings",children:[e.jsx("h3",{children:"Advanced Settings"}),e.jsxs("div",{className:"advanced-controls",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"cos-eps",children:"cos_eps (Model Stock):"}),e.jsx("input",{id:"cos-eps",type:"number",value:D,onChange:h=>I(parseFloat(h.target.value)),step:"1e-7",min:"1e-10"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"eps",children:"eps (Geometric Median):"}),e.jsx("input",{id:"eps",type:"number",value:J,onChange:h=>ee(parseFloat(h.target.value)),step:"1e-7",min:"1e-10"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"maxiter",children:"maxiter (Geometric Median):"}),e.jsx("input",{id:"maxiter",type:"number",value:E,onChange:h=>Z(parseInt(h.target.value)),min:"1"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"ftol",children:"ftol (Geometric Median):"}),e.jsx("input",{id:"ftol",type:"number",value:L,onChange:h=>se(parseFloat(h.target.value)),step:"1e-21",min:"1e-30"})]})]})]}),e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{onClick:V,className:"reset-btn",children:"Reset to Defaults"}),e.jsx(ce,{text:o,label:"Copy JSON",disabled:x!==null||Object.keys(d).length>0||u})]}),x&&e.jsxs("div",{style:{color:"var(--error-color, #e74c3c)",fontSize:"0.85rem",marginTop:"0.5rem"},children:["JSON Error: ",x]}),u&&e.jsx("div",{style:{color:"var(--error-color, #e74c3c)",fontSize:"0.85rem",marginTop:"0.5rem"},children:"Error: apply_stock and apply_median cannot both be enabled"})]}),e.jsx("div",{className:"output-section",children:e.jsx(me,{json:o})})]})]})}function Ge(){const[i,w]=c.useState("della_linear"),[j,A]=c.useState(2),[b,B]=c.useState([1,1]),[F,H]=c.useState([.2,.2]),[_,q]=c.useState([.01,.01]),[y,P]=c.useState(1),[C,K]=c.useState(!1),[U,Y]=c.useState(["Model 1","Model 2"]),[D,I]=c.useState({});c.useEffect(()=>{const o=Array(j).fill(1);B(o);const x=Array(j).fill(.2);H(x);const u=Array(j).fill(.01);q(u)},[j]),c.useEffect(()=>{const o=Array.from({length:j},(x,u)=>`Model ${u+1}`);Y(o)},[j]);const J=(o,x)=>{const u=[...b];u[o]=parseFloat(x),B(u)},ee=(o,x)=>{const u=[...F],h=parseFloat(x);u[o]=h,H(u);const M=se(h);I(M?O=>({...O,[`density_${o}`]:M}):O=>{const X={...O};return delete X[`density_${o}`],X});const z=_[o],T=G(h,z);I(T?O=>({...O,[`sum_${o}`]:T}):O=>{const X={...O};return delete X[`sum_${o}`],X})},E=(o,x)=>{const u=[..._],h=parseFloat(x);u[o]=h,q(u);const M=$(h);I(M?O=>({...O,[`gamma_${o}`]:M}):O=>{const X={...O};return delete X[`gamma_${o}`],X});const z=F[o],T=G(z,h);I(T?O=>({...O,[`sum_${o}`]:T}):O=>{const X={...O};return delete X[`sum_${o}`],X})},Z=()=>{const o=b.reduce((u,h)=>u+h,0);if(o===0)return;const x=b.map(u=>u/o);B(x)},L=(o,x)=>{const u=[...U];u[o]=x||`Model ${o+1}`,Y(u)},se=o=>isNaN(o)?"Density must be a number":o<0||o>1?`Density must be between 0.0 and 1.0, got ${o}`:null,$=o=>isNaN(o)?"Gamma must be a number":o<0||o>1?`Gamma must be between 0.0 and 1.0, got ${o}`:null,G=(o,x)=>o+x>1+1e-6?`Density (${o.toFixed(3)}) + Gamma (${x.toFixed(3)}) must be <= 1.0`:null,d=c.useMemo(()=>{const o={weights:b.map(u=>u.toFixed(3)).join(","),densities:F.map(u=>u.toFixed(3)).join(","),gammas:_.map(u=>u.toFixed(3)).join(",")};return i==="della_ties"&&(o.vote_sgn=C),JSON.stringify({lambda:y,global:o},null,2)},[i,y,b,F,_,C]),m=()=>{const o=Array(j).fill(1);B(o);const x=Array(j).fill(.2);H(x);const u=Array(j).fill(.01);q(u),P(1),K(!1),I({})},s=()=>e.jsxs("div",{className:"control-group",children:[e.jsx("label",{htmlFor:"merge-type",children:"Merge Type:"}),e.jsxs("select",{id:"merge-type",value:i,onChange:o=>w(o.target.value),className:"merge-type-select",children:[e.jsx("option",{value:"della_linear",children:"DELLA Linear"}),e.jsx("option",{value:"della_ties",children:"DELLA TIES"})]})]}),t=()=>e.jsxs("div",{className:"model-weights-section",children:[e.jsx("h3",{children:"Model Weights"}),e.jsx("div",{className:"model-sliders",children:b.map((o,x)=>e.jsxs("div",{className:"model-slider-container",children:[e.jsxs("div",{className:"slider-label-row",children:[e.jsx("input",{type:"text",value:U[x],onChange:u=>L(x,u.target.value),className:"model-name-input"}),e.jsxs("span",{children:[(o*100).toFixed(1),"%"]})]}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:o,onChange:u=>J(x,u.target.value),className:"slider"}),e.jsx("div",{className:"weight-value",children:o.toFixed(3)})]},x))}),e.jsx("div",{className:"normalize-row",children:e.jsx("button",{onClick:Z,className:"normalize-btn",children:"Normalize Weights"})})]}),n=()=>e.jsxs("div",{className:"densities-section",children:[e.jsx("h3",{children:"Densities (0.0-1.0)"}),e.jsx("div",{className:"model-sliders",children:F.map((o,x)=>e.jsxs("div",{className:"model-slider-container",children:[e.jsxs("div",{className:"slider-label-row",children:[e.jsxs("label",{htmlFor:`density-${x}`,children:[U[x],":"]}),e.jsxs("span",{children:[(o*100).toFixed(0),"%"]})]}),e.jsx("input",{id:`density-${x}`,type:"range",min:"0",max:"1",step:"0.01",value:o,onChange:u=>ee(x,u.target.value),className:"slider"}),e.jsx("div",{className:"weight-value",children:o.toFixed(3)}),D[`density_${x}`]&&e.jsx("small",{style:{color:"var(--error-color, #e74c3c)",fontSize:"0.75rem"},children:D[`density_${x}`]}),D[`sum_${x}`]&&e.jsx("small",{style:{color:"var(--error-color, #e74c3c)",fontSize:"0.75rem"},children:D[`sum_${x}`]})]},x))})]}),p=()=>e.jsxs("div",{className:"gammas-section",children:[e.jsx("h3",{children:"Gammas (0.0-1.0)"}),e.jsx("div",{className:"model-sliders",children:_.map((o,x)=>e.jsxs("div",{className:"model-slider-container",children:[e.jsxs("div",{className:"slider-label-row",children:[e.jsxs("label",{htmlFor:`gamma-${x}`,children:[U[x],":"]}),e.jsxs("span",{children:[(o*100).toFixed(0),"%"]})]}),e.jsx("input",{id:`gamma-${x}`,type:"range",min:"0",max:"1",step:"0.01",value:o,onChange:u=>E(x,u.target.value),className:"slider"}),e.jsx("div",{className:"weight-value",children:o.toFixed(3)}),D[`gamma_${x}`]&&e.jsx("small",{style:{color:"var(--error-color, #e74c3c)",fontSize:"0.75rem"},children:D[`gamma_${x}`]})]},x))}),e.jsx("small",{style:{color:"var(--text-secondary, #bdc3c7)",fontSize:"0.75rem",display:"block",marginTop:"0.5rem"},children:"Note: Density + Gamma must be <= 1.0 for each model"})]}),N=()=>e.jsxs("div",{className:"global-settings-section",children:[e.jsx("h3",{children:"Global Settings"}),e.jsxs("div",{className:"global-controls",children:[e.jsxs("div",{className:"control-group",children:[e.jsx("label",{htmlFor:"lambda",children:"Lambda (scaling parameter):"}),e.jsx("input",{id:"lambda",type:"number",value:y,onChange:o=>P(parseFloat(o.target.value)),step:"0.1",className:"lambda-input"})]}),i==="della_ties"&&e.jsx("div",{className:"flags-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:C,onChange:o=>K(o.target.checked)}),e.jsx("span",{children:"vote_sgn"})]})})]})]}),V=d;let R=null;try{JSON.parse(V)}catch(o){R=o instanceof Error?o.message:"Invalid JSON"}const le=Object.keys(D).length>0;return e.jsxs("div",{className:"della-config",children:[e.jsxs("div",{className:"config-header",children:[e.jsx("h2",{children:"DELLA Merging Configuration"}),e.jsx("p",{children:"Create JSON configuration for DELLA merge functions"})]}),e.jsxs("div",{className:"config-content",children:[e.jsxs("div",{className:"controls-section",children:[e.jsxs("div",{className:"basic-controls",children:[s(),e.jsxs("div",{className:"control-group",children:[e.jsx("label",{htmlFor:"num-models",children:"Number of Models (2-10):"}),e.jsxs("div",{className:"slider-with-value",children:[e.jsx("input",{id:"num-models",type:"range",min:"2",max:"10",value:j,onChange:o=>A(parseInt(o.target.value))}),e.jsx("span",{className:"slider-value",children:j})]})]})]}),N(),t(),n(),p(),e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{onClick:m,className:"reset-btn",children:"Reset to Defaults"}),e.jsx(ce,{text:V,label:"Copy JSON",disabled:R!==null||le})]}),R&&e.jsxs("div",{style:{color:"var(--error-color, #e74c3c)",fontSize:"0.85rem",marginTop:"0.5rem"},children:["JSON Error: ",R]}),le&&e.jsx("div",{style:{color:"var(--error-color, #e74c3c)",fontSize:"0.85rem",marginTop:"0.5rem"},children:"Please fix validation errors before copying JSON"})]}),e.jsx("div",{className:"output-section",children:e.jsx(me,{json:V})})]})]})}function Ie(){const[i,w]=c.useState("karcher_mean");return e.jsxs("div",{className:"ritya-tools-container",children:[e.jsxs("div",{className:"tabs-header",children:[e.jsx(de,{label:"Karcher Mean",active:i==="karcher_mean",onClick:()=>w("karcher_mean")}),e.jsx(de,{label:"Weight Sum",active:i==="weight_sum",onClick:()=>w("weight_sum")}),e.jsx(de,{label:"TIES Merging",active:i==="ties",onClick:()=>w("ties")}),e.jsx(de,{label:"TIES LoRA",active:i==="ties_lora",onClick:()=>w("ties_lora")}),e.jsx(de,{label:"DELLA",active:i==="della",onClick:()=>w("della")})]}),e.jsxs("div",{className:"tab-content",children:[i==="karcher_mean"&&e.jsx(Ae,{}),i==="weight_sum"&&e.jsx(ze,{}),i==="ties"&&e.jsx(De,{}),i==="ties_lora"&&e.jsx(Le,{}),i==="della"&&e.jsx(Ge,{})]})]})}export{Ie as default};
