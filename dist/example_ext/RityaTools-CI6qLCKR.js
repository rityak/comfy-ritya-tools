import{j as e}from"./main.js";import{r as m}from"./vendor-nf7bT_Uh.js";function E({text:n,label:o="Copy",onCopy:r,className:u=""}){const c=()=>{var p,g;navigator.clipboard.writeText(n),(g=(p=window.app)==null?void 0:p.extensionManager)!=null&&g.toast?window.app.extensionManager.toast.add({severity:"success",summary:"Copied",detail:"Content copied to clipboard",life:3e3}):alert("Copied to clipboard!"),r==null||r()};return e.jsx("button",{onClick:c,className:`copy-btn ${u}`,children:o})}function G({json:n,title:o="Generated JSON",showCopyButton:r=!0,maxHeight:u="200px"}){return e.jsxs("div",{className:"json-preview",children:[o&&e.jsx("h3",{children:o}),e.jsx("pre",{className:"json-display",style:{maxHeight:u},children:n}),r&&e.jsx(E,{text:n,label:"Copy JSON",className:"full-width"})]})}function B({label:n,active:o,onClick:r}){return e.jsx("button",{className:`tab-button ${o?"active":""}`,onClick:r,children:n})}function P(){return e.jsxs("div",{className:"example-tab",children:[e.jsx("h2",{children:"Hello World"}),e.jsx("p",{children:"This is an example tab for future utilities."})]})}const j=[{name:"IN",label:"Input Blocks",subBlocks:Array.from({length:9},(n,o)=>`IN${o.toString().padStart(2,"0")}`)},{name:"M",label:"Middle Block",subBlocks:["M00"]},{name:"OUT",label:"Output Blocks",subBlocks:Array.from({length:9},(n,o)=>`OUT${o.toString().padStart(2,"0")}`)},{name:"CLIP_L",label:"CLIP L",subBlocks:[]},{name:"CLIP_G",label:"CLIP G",subBlocks:[]},{name:"time_embed",label:"Time Embed",subBlocks:[]},{name:"label_emb",label:"Label Embed",subBlocks:[]}];function D(){const[n,o]=m.useState(2),[r,u]=m.useState([.5,.5]),[c,p]=m.useState({global:"0.5,0.5",max_iter:10,tol:1e-5}),[g,F]=m.useState(!1),[f,M]=m.useState(!1),[d,v]=m.useState({}),[h,N]=m.useState({});m.useEffect(()=>{const s=Array(n).fill(1/n);u(s),p(t=>({...t,global:s.map(i=>i.toFixed(3)).join(",")}));const a={},l={};j.forEach(t=>{t.subBlocks.length>0&&t.subBlocks.forEach(i=>{a[i]=s.map(x=>x.toFixed(3)).join(","),l[i]=!1}),a[t.name]=s.map(i=>i.toFixed(3)).join(","),l[t.name]=!1}),v(a),N(l)},[n]),m.useEffect(()=>{p(s=>({...s,global:r.map(a=>a.toFixed(3)).join(",")}))},[r]);const _=(s,a)=>{const l=[...r];l[s]=parseFloat(a),u(l)},A=()=>{const s=r.reduce((l,t)=>l+t,0);if(s===0)return;const a=r.map(l=>l/s);u(a)},z=()=>{const s={global:c.global,max_iter:c.max_iter,tol:c.tol};if(f){const a=[];j.forEach(t=>{t.subBlocks.forEach(i=>{const x=d[t.name]||c.global;h[i]&&d[i]!==x&&d[i]!==c.global&&a.push({name:i,weight:d[i]})})});const l=[];j.forEach(t=>{h[t.name]&&d[t.name]!==c.global&&l.push({name:t.name,weight:d[t.name]})}),[...a,...l].forEach(t=>{s[t.name]=t.weight})}return JSON.stringify(s,null,2)},[k,C]=m.useState(["Model 1","Model 2"]);m.useEffect(()=>{const s=Array.from({length:n},(a,l)=>`Model ${l+1}`);C(s)},[n]);const $=(s,a)=>{const l=[...k];l[s]=a||`Model ${s+1}`,C(l)},w=(s,a)=>{v(l=>({...l,[s]:a}))},y=s=>{N(a=>({...a,[s]:!a[s]}))},S=s=>{const l=(d[s]||c.global).split(",").map(b=>parseFloat(b)||0),t=l.reduce((b,L)=>b+L,0);if(t===0)return;const x=l.map(b=>b/t).map(b=>b.toFixed(3)).join(",");w(s,x)},T=()=>{const s=Array(n).fill(1/n);u(s),p({global:s.map(t=>t.toFixed(3)).join(","),max_iter:10,tol:1e-5});const a={},l={};j.forEach(t=>{t.subBlocks.length>0&&t.subBlocks.forEach(i=>{a[i]=s.map(x=>x.toFixed(3)).join(","),l[i]=!1}),a[t.name]=s.map(i=>i.toFixed(3)).join(","),l[t.name]=!1}),v(a),N(l)},I=()=>e.jsxs("div",{className:"model-weights-section",children:[e.jsx("h3",{children:"Model Weights"}),e.jsx("div",{className:"model-sliders",children:r.map((s,a)=>e.jsxs("div",{className:"model-slider-container",children:[e.jsxs("div",{className:"slider-label-row",children:[e.jsx("input",{type:"text",value:k[a],onChange:l=>$(a,l.target.value),className:"model-name-input"}),e.jsxs("span",{children:[(s*100).toFixed(1),"%"]})]}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:s,onChange:l=>_(a,l.target.value),className:"slider"}),e.jsx("div",{className:"weight-value",children:s.toFixed(3)})]},a))}),e.jsx("div",{className:"normalize-row",children:e.jsx("button",{onClick:A,className:"normalize-btn",children:"Normalize Global Weights"})})]}),O=()=>f?e.jsxs("div",{className:"block-controls",children:[e.jsx("h3",{children:"Block Weights"}),e.jsx("div",{className:"blocks-grid",children:j.map(s=>e.jsxs("div",{className:"block-group",children:[e.jsxs("div",{className:"group-header",children:[e.jsxs("div",{className:"group-label",children:[e.jsx("input",{type:"checkbox",checked:h[s.name]||!1,onChange:()=>y(s.name),id:`group-${s.name}`}),e.jsx("label",{htmlFor:`group-${s.name}`,children:s.label})]}),e.jsxs("div",{className:"group-input-row",children:[e.jsx("input",{type:"text",value:d[s.name]||c.global,onChange:a=>w(s.name,a.target.value),disabled:!h[s.name],placeholder:"Comma separated weights",className:"weights-input"}),e.jsx("button",{onClick:()=>S(s.name),disabled:!h[s.name],className:"normalize-btn small",children:"Normalize"})]})]}),s.subBlocks.length>0&&e.jsx("div",{className:"sub-blocks",children:s.subBlocks.map(a=>e.jsxs("div",{className:"sub-block",children:[e.jsxs("div",{className:"sub-block-content",children:[e.jsx("input",{type:"checkbox",checked:h[a]||!1,onChange:()=>y(a),id:`sub-${a}`}),e.jsx("label",{htmlFor:`sub-${a}`,children:a})]}),e.jsxs("div",{className:"sub-block-input-row",children:[e.jsx("input",{type:"text",value:d[a]||d[s.name]||c.global,onChange:l=>w(a,l.target.value),disabled:!h[a],placeholder:`Weights for ${a}`,className:"weights-input"}),e.jsx("button",{onClick:()=>S(a),disabled:!h[a],className:"normalize-btn small",children:"Normalize"})]})]},a))})]},s.name))})]}):null,J=()=>{const s=[];if(j.forEach(a=>{if(a.subBlocks.length>0&&a.subBlocks.forEach(l=>{if(h[l]){const t=d[l]||c.global,i=t?t.split(",").map(x=>parseFloat(x)||0):Array(n).fill(0);s.push({name:l,weights:i,type:"specific"})}}),h[a.name]){const l=d[a.name]||c.global,t=l?l.split(",").map(i=>parseFloat(i)||0):Array(n).fill(0);s.push({name:a.name,weights:t,type:"group"})}}),s.length===0){const a=c.global?c.global.split(",").map(l=>parseFloat(l)||0):Array(n).fill(0);s.push({name:"global",weights:a,type:"global"})}return e.jsxs("div",{className:"heatmap",children:[e.jsx("h3",{children:"Block Weights Visualization"}),e.jsxs("div",{className:"heatmap-grid",children:[e.jsxs("div",{className:"heatmap-headers",children:[e.jsx("div",{className:"block-label",children:"Block"}),Array.from({length:n}).map((a,l)=>e.jsx("div",{className:"model-header",children:k[l]||`Model ${l+1}`},l))]}),s.map((a,l)=>e.jsxs("div",{className:"heatmap-row",children:[e.jsx("div",{className:"block-label",children:a.name}),a.weights.map((t,i)=>e.jsx("div",{className:"heatmap-cell",style:{backgroundColor:`hsl(${t*120}, 70%, 30%)`},title:`Weight: ${t.toFixed(3)}`,children:t.toFixed(2)},i))]},l))]})]})},W=z();return e.jsxs("div",{className:"karcher-config",children:[e.jsxs("div",{className:"config-header",children:[e.jsx("h2",{children:"Karcher Mean Configuration"}),e.jsx("p",{children:"Create JSON configuration for karcher_mean_with_json function"})]}),e.jsxs("div",{className:"config-content",children:[e.jsxs("div",{className:"controls-section",children:[e.jsxs("div",{className:"basic-controls",children:[e.jsxs("div",{className:"control-group",children:[e.jsx("label",{htmlFor:"num-models",children:"Number of Models (2-10):"}),e.jsxs("div",{className:"slider-with-value",children:[e.jsx("input",{id:"num-models",type:"range",min:"2",max:"10",value:n,onChange:s=>o(parseInt(s.target.value))}),e.jsx("span",{className:"slider-value",children:n})]})]}),e.jsx("div",{className:"control-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:f,onChange:s=>M(s.target.checked)}),e.jsx("span",{children:"Show All Block Settings"})]})}),e.jsx("div",{className:"control-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:g,onChange:s=>F(s.target.checked)}),e.jsx("span",{children:"Show Advanced Settings"})]})})]}),I(),g&&e.jsxs("div",{className:"advanced-settings",children:[e.jsx("h3",{children:"Advanced Settings"}),e.jsxs("div",{className:"advanced-controls",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"max-iter",children:"Max Iterations:"}),e.jsx("input",{id:"max-iter",type:"number",value:c.max_iter,onChange:s=>p({...c,max_iter:parseInt(s.target.value)}),min:"1"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"tol",children:"Tolerance:"}),e.jsx("input",{id:"tol",type:"number",value:c.tol,onChange:s=>p({...c,tol:parseFloat(s.target.value)}),step:"1e-6",min:"1e-10"})]})]})]}),O(),e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{onClick:T,className:"reset-btn",children:"Reset to Defaults"}),e.jsx(E,{text:W,label:"Copy JSON"})]})]}),e.jsxs("div",{className:"output-section",children:[J(),e.jsx(G,{json:W})]})]})]})}function H(){const[n,o]=m.useState("karcher_mean");return e.jsxs("div",{className:"ritya-tools-container",children:[e.jsxs("div",{className:"tabs-header",children:[e.jsx(B,{label:"Karcher Mean",active:n==="karcher_mean",onClick:()=>o("karcher_mean")}),e.jsx(B,{label:"Example",active:n==="example",onClick:()=>o("example")})]}),e.jsxs("div",{className:"tab-content",children:[n==="karcher_mean"&&e.jsx(D,{}),n==="example"&&e.jsx(P,{})]})]})}export{H as default};
