import{j as e}from"./main.js";import{r as d}from"./vendor-nf7bT_Uh.js";function oe({text:i,label:N="Copy",onCopy:f,className:F="",disabled:u=!1}){const L=()=>{var $,U;u||(navigator.clipboard.writeText(i),(U=($=window.app)==null?void 0:$.extensionManager)!=null&&U.toast?window.app.extensionManager.toast.add({severity:"success",summary:"Copied",detail:"Content copied to clipboard",life:3e3}):alert("Copied to clipboard!"),f==null||f())};return e.jsx("button",{onClick:L,className:`copy-btn ${F}`,disabled:u,children:N})}function xe({json:i,title:N="Generated JSON",showCopyButton:f=!0,maxHeight:F="200px"}){return e.jsxs("div",{className:"json-preview",children:[N&&e.jsx("h3",{children:N}),e.jsx("pre",{className:"json-display",style:{maxHeight:F},children:i}),f&&e.jsx(oe,{text:i,label:"Copy JSON",className:"full-width"})]})}function ge({label:i,active:N,onClick:f}){return e.jsx("button",{className:`tab-button ${N?"active":""}`,onClick:f,children:i})}const te=[{name:"IN",label:"Input Blocks",subBlocks:Array.from({length:9},(i,N)=>`IN${N.toString().padStart(2,"0")}`)},{name:"M",label:"Middle Block",subBlocks:["M00"]},{name:"OUT",label:"Output Blocks",subBlocks:Array.from({length:9},(i,N)=>`OUT${N.toString().padStart(2,"0")}`)},{name:"CLIP_L",label:"CLIP L",subBlocks:[]},{name:"CLIP_G",label:"CLIP G",subBlocks:[]},{name:"time_embed",label:"Time Embed",subBlocks:[]},{name:"label_emb",label:"Label Embed",subBlocks:[]}];function Ae(){const[i,N]=d.useState(2),[f,F]=d.useState([.5,.5]),[u,L]=d.useState({global:"0.5,0.5",max_iter:10,tol:1e-5}),[$,U]=d.useState(!1),[S,K]=d.useState(!1),[v,G]=d.useState({}),[w,R]=d.useState({});d.useEffect(()=>{const s=Array(i).fill(1/i);F(s),L(p=>({...p,global:s.map(j=>j.toFixed(3)).join(",")}));const l={},n={};te.forEach(p=>{p.subBlocks.length>0&&p.subBlocks.forEach(j=>{l[j]=s.map(I=>I.toFixed(3)).join(","),n[j]=!1}),l[p.name]=s.map(j=>j.toFixed(3)).join(","),n[p.name]=!1}),G(l),R(n)},[i]),d.useEffect(()=>{L(s=>({...s,global:f.map(l=>l.toFixed(3)).join(",")}))},[f]);const P=(s,l)=>{const n=[...f];n[s]=parseFloat(l),F(n)},X=()=>{const s=f.reduce((n,p)=>n+p,0);if(s===0)return;const l=f.map(n=>n/s);F(l)},D=()=>{const s={global:u.global,max_iter:u.max_iter,tol:u.tol};if(S){const l=[];te.forEach(p=>{p.subBlocks.forEach(j=>{const I=v[p.name]||u.global;w[j]&&v[j]!==I&&v[j]!==u.global&&l.push({name:j,weight:v[j]})})});const n=[];te.forEach(p=>{w[p.name]&&v[p.name]!==u.global&&n.push({name:p.name,weight:v[p.name]})}),[...l,...n].forEach(p=>{s[p.name]=p.weight})}return JSON.stringify(s,null,2)},[q,B]=d.useState(["Model 1","Model 2"]);d.useEffect(()=>{const s=Array.from({length:i},(l,n)=>`Model ${n+1}`);B(s)},[i]);const Y=(s,l)=>{const n=[...q];n[s]=l||`Model ${s+1}`,B(n)},_=(s,l)=>{G(n=>({...n,[s]:l}))},Q=s=>{R(l=>({...l,[s]:!l[s]}))},E=s=>{const n=(v[s]||u.global).split(",").map(J=>parseFloat(J)||0),p=n.reduce((J,ie)=>J+ie,0);if(p===0)return;const I=n.map(J=>J/p).map(J=>J.toFixed(3)).join(",");_(s,I)},Z=()=>{const s=Array(i).fill(1/i);F(s),L({global:s.map(p=>p.toFixed(3)).join(","),max_iter:10,tol:1e-5});const l={},n={};te.forEach(p=>{p.subBlocks.length>0&&p.subBlocks.forEach(j=>{l[j]=s.map(I=>I.toFixed(3)).join(","),n[j]=!1}),l[p.name]=s.map(j=>j.toFixed(3)).join(","),n[p.name]=!1}),G(l),R(n)},C=()=>e.jsxs("div",{className:"model-weights-section",children:[e.jsx("h3",{children:"Model Weights"}),e.jsx("div",{className:"model-sliders",children:f.map((s,l)=>e.jsxs("div",{className:"model-slider-container",children:[e.jsxs("div",{className:"slider-label-row",children:[e.jsx("input",{type:"text",value:q[l],onChange:n=>Y(l,n.target.value),className:"model-name-input"}),e.jsxs("span",{children:[(s*100).toFixed(1),"%"]})]}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:s,onChange:n=>P(l,n.target.value),className:"slider"}),e.jsx("div",{className:"weight-value",children:s.toFixed(3)})]},l))}),e.jsx("div",{className:"normalize-row",children:e.jsx("button",{onClick:X,className:"normalize-btn",children:"Normalize Global Weights"})})]}),A=()=>S?e.jsxs("div",{className:"block-controls",children:[e.jsx("h3",{children:"Block Weights"}),e.jsx("div",{className:"blocks-grid",children:te.map(s=>e.jsxs("div",{className:"block-group",children:[e.jsxs("div",{className:"group-header",children:[e.jsxs("div",{className:"group-label",children:[e.jsx("input",{type:"checkbox",checked:w[s.name]||!1,onChange:()=>Q(s.name),id:`group-${s.name}`}),e.jsx("label",{htmlFor:`group-${s.name}`,children:s.label})]}),e.jsxs("div",{className:"group-input-row",children:[e.jsx("input",{type:"text",value:v[s.name]||u.global,onChange:l=>_(s.name,l.target.value),disabled:!w[s.name],placeholder:"Comma separated weights",className:"weights-input"}),e.jsx("button",{onClick:()=>E(s.name),disabled:!w[s.name],className:"normalize-btn small",children:"Normalize"})]})]}),s.subBlocks.length>0&&e.jsx("div",{className:"sub-blocks",children:s.subBlocks.map(l=>e.jsxs("div",{className:"sub-block",children:[e.jsxs("div",{className:"sub-block-content",children:[e.jsx("input",{type:"checkbox",checked:w[l]||!1,onChange:()=>Q(l),id:`sub-${l}`}),e.jsx("label",{htmlFor:`sub-${l}`,children:l})]}),e.jsxs("div",{className:"sub-block-input-row",children:[e.jsx("input",{type:"text",value:v[l]||v[s.name]||u.global,onChange:n=>_(l,n.target.value),disabled:!w[l],placeholder:`Weights for ${l}`,className:"weights-input"}),e.jsx("button",{onClick:()=>E(l),disabled:!w[l],className:"normalize-btn small",children:"Normalize"})]})]},l))})]},s.name))})]}):null,o=()=>{const s=[];if(te.forEach(l=>{if(l.subBlocks.length>0&&l.subBlocks.forEach(n=>{if(w[n]){const p=v[n]||u.global,j=p?p.split(",").map(I=>parseFloat(I)||0):Array(i).fill(0);s.push({name:n,weights:j,type:"specific"})}}),w[l.name]){const n=v[l.name]||u.global,p=n?n.split(",").map(j=>parseFloat(j)||0):Array(i).fill(0);s.push({name:l.name,weights:p,type:"group"})}}),s.length===0){const l=u.global?u.global.split(",").map(n=>parseFloat(n)||0):Array(i).fill(0);s.push({name:"global",weights:l,type:"global"})}return e.jsxs("div",{className:"heatmap",children:[e.jsx("h3",{children:"Block Weights Visualization"}),e.jsxs("div",{className:"heatmap-grid",children:[e.jsxs("div",{className:"heatmap-headers",children:[e.jsx("div",{className:"block-label",children:"Block"}),Array.from({length:i}).map((l,n)=>e.jsx("div",{className:"model-header",children:q[n]||`Model ${n+1}`},n))]}),s.map((l,n)=>e.jsxs("div",{className:"heatmap-row",children:[e.jsx("div",{className:"block-label",children:l.name}),l.weights.map((p,j)=>e.jsx("div",{className:"heatmap-cell",style:{backgroundColor:`hsl(${p*120}, 70%, 30%)`},title:`Weight: ${p.toFixed(3)}`,children:p.toFixed(2)},j))]},n))]})]})},r=D();return e.jsxs("div",{className:"karcher-config",children:[e.jsxs("div",{className:"config-header",children:[e.jsx("h2",{children:"Karcher Mean Configuration"}),e.jsx("p",{children:"Create JSON configuration for karcher_mean_with_json function"})]}),e.jsxs("div",{className:"config-content",children:[e.jsxs("div",{className:"controls-section",children:[e.jsxs("div",{className:"basic-controls",children:[e.jsxs("div",{className:"control-group",children:[e.jsx("label",{htmlFor:"num-models",children:"Number of Models (2-10):"}),e.jsxs("div",{className:"slider-with-value",children:[e.jsx("input",{id:"num-models",type:"range",min:"2",max:"10",value:i,onChange:s=>N(parseInt(s.target.value))}),e.jsx("span",{className:"slider-value",children:i})]})]}),e.jsx("div",{className:"control-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:S,onChange:s=>K(s.target.checked)}),e.jsx("span",{children:"Show All Block Settings"})]})}),e.jsx("div",{className:"control-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:$,onChange:s=>U(s.target.checked)}),e.jsx("span",{children:"Show Advanced Settings"})]})})]}),C(),$&&e.jsxs("div",{className:"advanced-settings",children:[e.jsx("h3",{children:"Advanced Settings"}),e.jsxs("div",{className:"advanced-controls",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"max-iter",children:"Max Iterations:"}),e.jsx("input",{id:"max-iter",type:"number",value:u.max_iter,onChange:s=>L({...u,max_iter:parseInt(s.target.value)}),min:"1"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"tol",children:"Tolerance:"}),e.jsx("input",{id:"tol",type:"number",value:u.tol,onChange:s=>L({...u,tol:parseFloat(s.target.value)}),step:"1e-6",min:"1e-10"})]})]})]}),A(),e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{onClick:Z,className:"reset-btn",children:"Reset to Defaults"}),e.jsx(oe,{text:r,label:"Copy JSON"})]})]}),e.jsxs("div",{className:"output-section",children:[o(),e.jsx(xe,{json:r})]})]})]})}const le=[{name:"IN",label:"Input Blocks",subBlocks:Array.from({length:9},(i,N)=>`IN${N.toString().padStart(2,"0")}`)},{name:"M",label:"Middle Block",subBlocks:["M00"]},{name:"OUT",label:"Output Blocks",subBlocks:Array.from({length:9},(i,N)=>`OUT${N.toString().padStart(2,"0")}`)},{name:"CLIP_L",label:"CLIP L",subBlocks:[]},{name:"CLIP_G",label:"CLIP G",subBlocks:[]},{name:"time_embed",label:"Time Embed",subBlocks:[]},{name:"label_emb",label:"Label Embed",subBlocks:[]}];function ze(){const[i,N]=d.useState(2),[f,F]=d.useState([.5,.5]),[u,L]=d.useState("0.5,0.5"),[$,U]=d.useState(!1),[S,K]=d.useState({}),[v,G]=d.useState({});d.useEffect(()=>{const o=Array(i).fill(1/i);F(o);const r=o.map(n=>n.toFixed(3)).join(",");L(r);const s={},l={};le.forEach(n=>{n.subBlocks.length>0&&n.subBlocks.forEach(p=>{s[p]=r,l[p]=!1}),s[n.name]=r,l[n.name]=!1}),K(s),G(l)},[i]),d.useEffect(()=>{const o=f.map(r=>r.toFixed(3)).join(",");L(o)},[f]);const w=(o,r)=>{const s=[...f];s[o]=parseFloat(r),F(s)},R=()=>{const o=f.reduce((s,l)=>s+l,0);if(o===0)return;const r=f.map(s=>s/o);F(r)},P=()=>{const o={global:u};if($){const r=[];le.forEach(l=>{l.subBlocks.forEach(n=>{const p=S[l.name]||u;v[n]&&S[n]!==p&&S[n]!==u&&r.push({name:n,weight:S[n]})})});const s=[];le.forEach(l=>{v[l.name]&&S[l.name]!==u&&s.push({name:l.name,weight:S[l.name]})}),[...r,...s].forEach(l=>{o[l.name]=l.weight})}return JSON.stringify(o,null,2)},[X,D]=d.useState(["Model 1","Model 2"]);d.useEffect(()=>{const o=Array.from({length:i},(r,s)=>`Model ${s+1}`);D(o)},[i]);const q=(o,r)=>{const s=[...X];s[o]=r||`Model ${o+1}`,D(s)},B=(o,r)=>{K(s=>({...s,[o]:r}))},Y=o=>{G(r=>({...r,[o]:!r[o]}))},_=o=>{const s=(S[o]||u).split(",").map(j=>parseFloat(j)||0),l=s.reduce((j,I)=>j+I,0);if(l===0)return;const p=s.map(j=>j/l).map(j=>j.toFixed(3)).join(",");B(o,p)},Q=()=>{const o=Array(i).fill(1/i);F(o);const r=o.map(n=>n.toFixed(3)).join(",");L(r);const s={},l={};le.forEach(n=>{n.subBlocks.length>0&&n.subBlocks.forEach(p=>{s[p]=r,l[p]=!1}),s[n.name]=r,l[n.name]=!1}),K(s),G(l)},E=()=>e.jsxs("div",{className:"model-weights-section",children:[e.jsx("h3",{children:"Model Weights"}),e.jsx("div",{className:"model-sliders",children:f.map((o,r)=>e.jsxs("div",{className:"model-slider-container",children:[e.jsxs("div",{className:"slider-label-row",children:[e.jsx("input",{type:"text",value:X[r],onChange:s=>q(r,s.target.value),className:"model-name-input"}),e.jsxs("span",{children:[(o*100).toFixed(1),"%"]})]}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:o,onChange:s=>w(r,s.target.value),className:"slider"}),e.jsx("div",{className:"weight-value",children:o.toFixed(3)})]},r))}),e.jsx("div",{className:"normalize-row",children:e.jsx("button",{onClick:R,className:"normalize-btn",children:"Normalize Global Weights"})})]}),Z=()=>$?e.jsxs("div",{className:"block-controls",children:[e.jsx("h3",{children:"Block Weights"}),e.jsx("div",{className:"blocks-grid",children:le.map(o=>e.jsxs("div",{className:"block-group",children:[e.jsxs("div",{className:"group-header",children:[e.jsxs("div",{className:"group-label",children:[e.jsx("input",{type:"checkbox",checked:v[o.name]||!1,onChange:()=>Y(o.name),id:`group-${o.name}`}),e.jsx("label",{htmlFor:`group-${o.name}`,children:o.label})]}),e.jsxs("div",{className:"group-input-row",children:[e.jsx("input",{type:"text",value:S[o.name]||u,onChange:r=>B(o.name,r.target.value),disabled:!v[o.name],placeholder:"Comma separated weights",className:"weights-input"}),e.jsx("button",{onClick:()=>_(o.name),disabled:!v[o.name],className:"normalize-btn small",children:"Normalize"})]})]}),o.subBlocks.length>0&&e.jsx("div",{className:"sub-blocks",children:o.subBlocks.map(r=>e.jsxs("div",{className:"sub-block",children:[e.jsxs("div",{className:"sub-block-content",children:[e.jsx("input",{type:"checkbox",checked:v[r]||!1,onChange:()=>Y(r),id:`sub-${r}`}),e.jsx("label",{htmlFor:`sub-${r}`,children:r})]}),e.jsxs("div",{className:"sub-block-input-row",children:[e.jsx("input",{type:"text",value:S[r]||S[o.name]||u,onChange:s=>B(r,s.target.value),disabled:!v[r],placeholder:`Weights for ${r}`,className:"weights-input"}),e.jsx("button",{onClick:()=>_(r),disabled:!v[r],className:"normalize-btn small",children:"Normalize"})]})]},r))})]},o.name))})]}):null,C=()=>{const o=[];if(le.forEach(r=>{if(r.subBlocks.length>0&&r.subBlocks.forEach(s=>{if(v[s]){const l=S[s]||u,n=l?l.split(",").map(p=>parseFloat(p)||0):Array(i).fill(0);o.push({name:s,weights:n,type:"specific"})}}),v[r.name]){const s=S[r.name]||u,l=s?s.split(",").map(n=>parseFloat(n)||0):Array(i).fill(0);o.push({name:r.name,weights:l,type:"group"})}}),o.length===0){const r=u?u.split(",").map(s=>parseFloat(s)||0):Array(i).fill(0);o.push({name:"global",weights:r,type:"global"})}return e.jsxs("div",{className:"heatmap",children:[e.jsx("h3",{children:"Block Weights Visualization"}),e.jsxs("div",{className:"heatmap-grid",children:[e.jsxs("div",{className:"heatmap-headers",children:[e.jsx("div",{className:"block-label",children:"Block"}),Array.from({length:i}).map((r,s)=>e.jsx("div",{className:"model-header",children:X[s]||`Model ${s+1}`},s))]}),o.map((r,s)=>e.jsxs("div",{className:"heatmap-row",children:[e.jsx("div",{className:"block-label",children:r.name}),r.weights.map((l,n)=>e.jsx("div",{className:"heatmap-cell",style:{backgroundColor:`hsl(${l*120}, 70%, 30%)`},title:`Weight: ${l.toFixed(3)}`,children:l.toFixed(2)},n))]},s))]})]})},A=P();return e.jsxs("div",{className:"weight-sum-config",children:[e.jsxs("div",{className:"config-header",children:[e.jsx("h2",{children:"Weight Sum Configuration"}),e.jsx("p",{children:"Create JSON configuration for weight_sum_with_json function"})]}),e.jsxs("div",{className:"config-content",children:[e.jsxs("div",{className:"controls-section",children:[e.jsxs("div",{className:"basic-controls",children:[e.jsxs("div",{className:"control-group",children:[e.jsx("label",{htmlFor:"num-models",children:"Number of Models (2-10):"}),e.jsxs("div",{className:"slider-with-value",children:[e.jsx("input",{id:"num-models",type:"range",min:"2",max:"10",value:i,onChange:o=>N(parseInt(o.target.value))}),e.jsx("span",{className:"slider-value",children:i})]})]}),e.jsx("div",{className:"control-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:$,onChange:o=>U(o.target.checked)}),e.jsx("span",{children:"Show All Block Settings"})]})})]}),E(),Z(),e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{onClick:Q,className:"reset-btn",children:"Reset to Defaults"}),e.jsx(oe,{text:A,label:"Copy JSON"})]})]}),e.jsxs("div",{className:"output-section",children:[C(),e.jsx(xe,{json:A})]})]})]})}const ne=[{name:"IN",label:"Input Blocks",subBlocks:Array.from({length:9},(i,N)=>`IN${N.toString().padStart(2,"0")}`)},{name:"M",label:"Middle Block",subBlocks:["M00"]},{name:"OUT",label:"Output Blocks",subBlocks:Array.from({length:9},(i,N)=>`OUT${N.toString().padStart(2,"0")}`)},{name:"CLIP_L",label:"CLIP L",subBlocks:[]},{name:"CLIP_G",label:"CLIP G",subBlocks:[]},{name:"time_embed",label:"Time Embed",subBlocks:[]},{name:"label_emb",label:"Label Embed",subBlocks:[]}];function Be(){const[i,N]=d.useState(2),[f,F]=d.useState([1,1]),[u,L]=d.useState(1),[$,U]=d.useState(1e-6),[S,K]=d.useState(1e-6),[v,G]=d.useState(100),[w,R]=d.useState(1e-20),[P,X]=d.useState(!1),[D,q]=d.useState(!1),[B,Y]=d.useState(!1),[_,Q]=d.useState("1.0,1.0"),[E,Z]=d.useState("0.2,0.2"),[C,A]=d.useState({}),[o,r]=d.useState(!1),[s,l]=d.useState(!1),[n,p]=d.useState(!1),[j,I]=d.useState(!1),[J,ie]=d.useState(!1),[V,ee]=d.useState({}),[M,h]=d.useState({}),[z,W]=d.useState(["Model 1","Model 2"]);d.useEffect(()=>{const a=Array(i).fill(1);F(a);const c=a.map(b=>b.toFixed(1)).join(","),t=Array(i).fill(.2).join(",");Q(c),Z(t);const m={},x={};ne.forEach(b=>{b.subBlocks.length>0&&b.subBlocks.forEach(y=>{m[y]={weights:c,densities:t},x[y]=!1}),m[b.name]={weights:c,densities:t},x[b.name]=!1}),ee(m),h(x)},[i]),d.useEffect(()=>{const a=Array.from({length:i},(c,t)=>`Model ${t+1}`);W(a)},[i]),d.useEffect(()=>{const a=f.map(c=>c.toFixed(3)).join(",");Q(a),A(c=>{const t={...c};return delete t["global-weights"],t})},[f]);const O=(a,c)=>a!==void 0?a:c,ae=a=>{if(!a.trim())return"Densities cannot be empty";const c=a.split(",").map(t=>t.trim());if(c.length!==i)return`Must have exactly ${i} density values (one per model)`;for(let t=0;t<c.length;t++){const m=parseFloat(c[t]);if(isNaN(m))return`Invalid density value at position ${t+1}: "${c[t]}"`;if(m<0||m>1)return`Density at position ${t+1} must be between 0.0 and 1.0, got ${m}`}return null},je=a=>{if(!a.trim())return"Weights cannot be empty";const c=a.split(",").map(t=>t.trim());if(c.length!==i)return`Must have exactly ${i} weight values (one per model)`;for(let t=0;t<c.length;t++){const m=parseFloat(c[t]);if(isNaN(m))return`Invalid weight value at position ${t+1}: "${c[t]}"`}return null},ye=(a,c)=>{const t=[...f];t[a]=parseFloat(c),F(t)},Ne=()=>{const a=f.reduce((t,m)=>t+m,0);if(a===0)return;const c=f.map(t=>t/a);F(c)},T=(a,c)=>{ee(t=>({...t,[a]:{...t[a],...c}}))},be=a=>{h(c=>({...c,[a]:!c[a]}))},fe=a=>{const m=(V[a]||{weights:_}).weights.split(",").map(g=>parseFloat(g)||0),x=m.reduce((g,H)=>g+H,0);if(x===0)return;const y=m.map(g=>g/x).map(g=>g.toFixed(3)).join(",");T(a,{weights:y})},ke=(a,c)=>{const t=[...z];t[a]=c||`Model ${a+1}`,W(t)},we=d.useMemo(()=>{const a={lambda:u,cos_eps:$,eps:S,maxiter:v,ftol:w,vote_sgn:P,apply_stock:D,apply_median:B,global:{weights:_,densities:E}};o!==P&&(a.global.vote_sgn=o),s!==D&&(a.global.apply_stock=s),n!==B&&(a.global.apply_median=n);const c=o!==P?o:P,t=s!==D?s:D,m=n!==B?n:B;if(J){const x=[];ne.forEach(y=>{const g=V[y.name]||{weights:_,densities:E},H=O(g.vote_sgn,c),de=O(g.apply_stock,t),he=O(g.apply_median,m);y.subBlocks.forEach(ce=>{const k=V[ce]||{weights:g.weights,densities:g.densities},me=O(k.vote_sgn,H),se=O(k.apply_stock,de),ve=O(k.apply_median,he),Me=k.weights!==g.weights&&k.weights!==_,We=k.densities!==g.densities&&k.densities!==E,$e=k.vote_sgn!==void 0&&k.vote_sgn!==me||k.apply_stock!==void 0&&k.apply_stock!==se||k.apply_median!==void 0&&k.apply_median!==ve;if(M[ce]&&(Me||We||$e)){const pe={weights:k.weights,densities:k.densities};k.vote_sgn!==void 0&&k.vote_sgn!==me&&(pe.vote_sgn=k.vote_sgn),k.apply_stock!==void 0&&k.apply_stock!==se&&(pe.apply_stock=k.apply_stock),k.apply_median!==void 0&&k.apply_median!==ve&&(pe.apply_median=k.apply_median),x.push({name:ce,config:pe})}})});const b=[];ne.forEach(y=>{const g=V[y.name]||{weights:_,densities:E},H=O(g.vote_sgn,c),de=O(g.apply_stock,t),he=O(g.apply_median,m),ce=g.weights!==_,k=g.densities!==E,me=g.vote_sgn!==void 0&&g.vote_sgn!==H||g.apply_stock!==void 0&&g.apply_stock!==de||g.apply_median!==void 0&&g.apply_median!==he;if(M[y.name]&&(ce||k||me)){const se={weights:g.weights,densities:g.densities};g.vote_sgn!==void 0&&g.vote_sgn!==H&&(se.vote_sgn=g.vote_sgn),g.apply_stock!==void 0&&g.apply_stock!==de&&(se.apply_stock=g.apply_stock),g.apply_median!==void 0&&g.apply_median!==he&&(se.apply_median=g.apply_median),b.push({name:y.name,config:se})}}),[...x,...b].forEach(y=>{a[y.name]=y.config})}return JSON.stringify(a,null,2)},[u,$,S,v,w,P,D,B,_,E,o,s,n,J,M,V,i]),Se=()=>{const a=Array(i).fill(1);F(a);const c=a.map(b=>b.toFixed(1)).join(","),t=Array(i).fill(.2).join(",");Q(c),Z(t),A({}),L(1),U(1e-6),K(1e-6),G(100),R(1e-20),X(!1),q(!1),Y(!1),r(!1),l(!1),p(!1);const m={},x={};ne.forEach(b=>{b.subBlocks.length>0&&b.subBlocks.forEach(y=>{m[y]={weights:c,densities:t},x[y]=!1}),m[b.name]={weights:c,densities:t},x[b.name]=!1}),ee(m),h(x)},_e=()=>e.jsxs("div",{className:"model-weights-section",children:[e.jsx("h3",{children:"Model Weights"}),e.jsx("div",{className:"model-sliders",children:f.map((a,c)=>e.jsxs("div",{className:"model-slider-container",children:[e.jsxs("div",{className:"slider-label-row",children:[e.jsx("input",{type:"text",value:z[c],onChange:t=>ke(c,t.target.value),className:"model-name-input"}),e.jsxs("span",{children:[(a*100).toFixed(1),"%"]})]}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:a,onChange:t=>ye(c,t.target.value),className:"slider"}),e.jsx("div",{className:"weight-value",children:a.toFixed(3)})]},c))}),e.jsx("div",{className:"normalize-row",children:e.jsx("button",{onClick:Ne,className:"normalize-btn",children:"Normalize Global Weights"})})]}),Ce=()=>e.jsxs("div",{className:"global-settings-section",children:[e.jsx("h3",{children:"Global Settings"}),e.jsxs("div",{className:"global-controls",children:[e.jsxs("div",{className:"control-group",children:[e.jsx("label",{htmlFor:"lambda",children:"Lambda (scaling parameter):"}),e.jsx("input",{id:"lambda",type:"number",value:u,onChange:a=>L(parseFloat(a.target.value)),step:"0.1",className:"lambda-input"})]}),e.jsxs("div",{className:"control-group",children:[e.jsx("label",{htmlFor:"global-densities",children:"Global Densities (0.0-1.0):"}),e.jsx("input",{id:"global-densities",type:"text",value:E,onChange:a=>{const c=a.target.value;Z(c);const t=ae(c);A(t?m=>({...m,"global-densities":t}):m=>{const x={...m};return delete x["global-densities"],x})},placeholder:"Comma separated densities",className:`densities-input ${C["global-densities"]?"error":""}`}),C["global-densities"]&&e.jsx("small",{style:{color:"var(--error-color, #e74c3c)",fontSize:"0.75rem"},children:C["global-densities"]}),!C["global-densities"]&&e.jsx("small",{style:{color:"var(--text-secondary, #bdc3c7)",fontSize:"0.75rem"},children:"Density values should be between 0.0 and 1.0 for each model"})]}),e.jsxs("div",{className:"flags-group",children:[e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:P,onChange:a=>X(a.target.checked)}),e.jsx("span",{children:"vote_sgn (root level)"})]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:D,onChange:a=>q(a.target.checked)}),e.jsx("span",{children:"apply_stock (root level)"})]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:B,onChange:a=>Y(a.target.checked)}),e.jsx("span",{children:"apply_median (root level)"})]})]}),e.jsxs("div",{className:"flags-group",children:[e.jsx("h4",{style:{margin:"0.5rem 0",fontSize:"0.85rem",color:"var(--text-primary, #ecf0f1)"},children:"Global Block Flags:"}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:o,onChange:a=>r(a.target.checked)}),e.jsx("span",{children:"vote_sgn (global)"})]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:s,onChange:a=>{a.target.checked&&n?(l(!0),p(!1)):l(a.target.checked)},disabled:n===!0}),e.jsx("span",{children:"apply_stock (global)"}),n&&e.jsx("small",{style:{color:"var(--text-secondary, #bdc3c7)",fontSize:"0.7rem",marginLeft:"0.25rem"},children:"(disabled when apply_median is enabled)"})]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:n,onChange:a=>{a.target.checked&&s?(p(!0),l(!1)):p(a.target.checked)}}),e.jsx("span",{children:"apply_median (global)"}),n&&s&&e.jsx("small",{style:{color:"var(--warning-color, #f39c12)",fontSize:"0.7rem",marginLeft:"0.25rem"},children:"(has priority over apply_stock)"})]})]})]})]}),Fe=()=>J?e.jsxs("div",{className:"block-controls",children:[e.jsx("h3",{children:"Block Settings"}),e.jsx("div",{className:"blocks-grid",children:ne.map(a=>{const c=V[a.name]||{weights:_,densities:E};return e.jsxs("div",{className:"block-group",children:[e.jsx("div",{className:"group-header",children:e.jsxs("div",{className:"group-label",children:[e.jsx("input",{type:"checkbox",checked:M[a.name]||!1,onChange:()=>be(a.name),id:`group-${a.name}`}),e.jsx("label",{htmlFor:`group-${a.name}`,children:a.label})]})}),e.jsxs("div",{className:"group-controls",children:[e.jsxs("div",{className:"control-group",children:[e.jsx("label",{htmlFor:`weights-${a.name}`,children:"Weights:"}),e.jsxs("div",{className:"input-with-button",children:[e.jsx("input",{id:`weights-${a.name}`,type:"text",value:c.weights,onChange:t=>{const m=t.target.value;T(a.name,{weights:m});const x=je(m);A(x?b=>({...b,[`weights-${a.name}`]:x}):b=>{const y={...b};return delete y[`weights-${a.name}`],y})},disabled:!M[a.name],placeholder:"Comma separated weights",className:`weights-input ${C[`weights-${a.name}`]?"error":""}`}),e.jsx("button",{onClick:()=>fe(a.name),disabled:!M[a.name],className:"normalize-btn small",children:"Normalize"})]})]}),e.jsxs("div",{className:"control-group",children:[e.jsx("label",{htmlFor:`densities-${a.name}`,children:"Densities (0.0-1.0):"}),e.jsx("input",{id:`densities-${a.name}`,type:"text",value:c.densities,onChange:t=>{const m=t.target.value;T(a.name,{densities:m});const x=ae(m);A(x?b=>({...b,[`densities-${a.name}`]:x}):b=>{const y={...b};return delete y[`densities-${a.name}`],y})},disabled:!M[a.name],placeholder:"Comma separated densities",className:`densities-input ${C[`densities-${a.name}`]?"error":""}`}),C[`densities-${a.name}`]&&e.jsx("small",{style:{color:"var(--error-color, #e74c3c)",fontSize:"0.75rem"},children:C[`densities-${a.name}`]}),C[`weights-${a.name}`]&&e.jsx("small",{style:{color:"var(--error-color, #e74c3c)",fontSize:"0.75rem"},children:C[`weights-${a.name}`]})]}),e.jsxs("div",{className:"flags-group",children:[e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:c.vote_sgn||!1,onChange:t=>T(a.name,{vote_sgn:t.target.checked}),disabled:!M[a.name]}),e.jsx("span",{children:"vote_sgn"})]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:c.apply_stock||!1,onChange:t=>{t.target.checked&&c.apply_median?T(a.name,{apply_stock:!0,apply_median:!1}):T(a.name,{apply_stock:t.target.checked})},disabled:!M[a.name]||c.apply_median===!0}),e.jsx("span",{children:"apply_stock"}),c.apply_median&&e.jsx("small",{style:{color:"var(--text-secondary, #bdc3c7)",fontSize:"0.7rem",marginLeft:"0.25rem"},children:"(disabled when apply_median is enabled)"})]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:c.apply_median||!1,onChange:t=>{t.target.checked&&c.apply_stock?T(a.name,{apply_median:!0,apply_stock:!1}):T(a.name,{apply_median:t.target.checked})},disabled:!M[a.name]}),e.jsx("span",{children:"apply_median"}),c.apply_median&&c.apply_stock&&e.jsx("small",{style:{color:"var(--warning-color, #f39c12)",fontSize:"0.7rem",marginLeft:"0.25rem"},children:"(has priority over apply_stock)"})]})]})]}),a.subBlocks.length>0&&e.jsx("div",{className:"sub-blocks",children:a.subBlocks.map(t=>{const m=V[t]||{weights:c.weights,densities:c.densities};return e.jsxs("div",{className:"sub-block",children:[e.jsxs("div",{className:"sub-block-content",children:[e.jsx("input",{type:"checkbox",checked:M[t]||!1,onChange:()=>be(t),id:`sub-${t}`}),e.jsx("label",{htmlFor:`sub-${t}`,children:t})]}),e.jsxs("div",{className:"sub-block-controls",children:[e.jsxs("div",{className:"control-group",children:[e.jsx("label",{htmlFor:`weights-${t}`,children:"Weights:"}),e.jsxs("div",{className:"input-with-button",children:[e.jsx("input",{id:`weights-${t}`,type:"text",value:m.weights,onChange:x=>{const b=x.target.value;T(t,{weights:b});const y=je(b);A(y?g=>({...g,[`weights-${t}`]:y}):g=>{const H={...g};return delete H[`weights-${t}`],H})},disabled:!M[t],placeholder:`Weights for ${t}`,className:`weights-input ${C[`weights-${t}`]?"error":""}`}),e.jsx("button",{onClick:()=>fe(t),disabled:!M[t],className:"normalize-btn small",children:"Normalize"})]})]}),e.jsxs("div",{className:"control-group",children:[e.jsx("label",{htmlFor:`densities-${t}`,children:"Densities (0.0-1.0):"}),e.jsx("input",{id:`densities-${t}`,type:"text",value:m.densities,onChange:x=>{const b=x.target.value;T(t,{densities:b});const y=ae(b);A(y?g=>({...g,[`densities-${t}`]:y}):g=>{const H={...g};return delete H[`densities-${t}`],H})},disabled:!M[t],placeholder:`Densities for ${t}`,className:`densities-input ${C[`densities-${t}`]?"error":""}`}),C[`densities-${t}`]&&e.jsx("small",{style:{color:"var(--error-color, #e74c3c)",fontSize:"0.75rem"},children:C[`densities-${t}`]}),C[`weights-${t}`]&&e.jsx("small",{style:{color:"var(--error-color, #e74c3c)",fontSize:"0.75rem"},children:C[`weights-${t}`]})]}),e.jsxs("div",{className:"flags-group",children:[e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:m.vote_sgn||!1,onChange:x=>T(t,{vote_sgn:x.target.checked}),disabled:!M[t]}),e.jsx("span",{children:"vote_sgn"})]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:m.apply_stock||!1,onChange:x=>{x.target.checked&&m.apply_median?T(t,{apply_stock:!0,apply_median:!1}):T(t,{apply_stock:x.target.checked})},disabled:!M[t]||m.apply_median===!0}),e.jsx("span",{children:"apply_stock"}),m.apply_median&&e.jsx("small",{style:{color:"var(--text-secondary, #bdc3c7)",fontSize:"0.7rem",marginLeft:"0.25rem"},children:"(disabled when apply_median is enabled)"})]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:m.apply_median||!1,onChange:x=>{x.target.checked&&m.apply_stock?T(t,{apply_median:!0,apply_stock:!1}):T(t,{apply_median:x.target.checked})},disabled:!M[t]}),e.jsx("span",{children:"apply_median"}),m.apply_median&&m.apply_stock&&e.jsx("small",{style:{color:"var(--warning-color, #f39c12)",fontSize:"0.7rem",marginLeft:"0.25rem"},children:"(has priority over apply_stock)"})]})]})]})]},t)})})]},a.name)})})]}):null,Ee=()=>{const a=[];if(ne.forEach(c=>{if(c.subBlocks.length>0&&c.subBlocks.forEach(t=>{if(M[t]){const m=V[t]||{weights:_,densities:E},x=m.weights?m.weights.split(",").map(y=>parseFloat(y)||0):Array(i).fill(0),b=m.densities?m.densities.split(",").map(y=>parseFloat(y)||0):Array(i).fill(0);a.push({name:t,weights:x,densities:b,type:"specific"})}}),M[c.name]){const t=V[c.name]||{weights:_,densities:E},m=t.weights?t.weights.split(",").map(b=>parseFloat(b)||0):Array(i).fill(0),x=t.densities?t.densities.split(",").map(b=>parseFloat(b)||0):Array(i).fill(0);a.push({name:c.name,weights:m,densities:x,type:"group"})}}),a.length===0){const c=_?_.split(",").map(m=>parseFloat(m)||0):Array(i).fill(0),t=E?E.split(",").map(m=>parseFloat(m)||0):Array(i).fill(0);a.push({name:"global",weights:c,densities:t,type:"global"})}return e.jsxs("div",{className:"heatmap",children:[e.jsx("h3",{children:"Block Weights & Densities Visualization"}),e.jsxs("div",{className:"heatmap-grid",children:[e.jsxs("div",{className:"heatmap-headers",children:[e.jsx("div",{className:"block-label",children:"Block"}),Array.from({length:i}).map((c,t)=>e.jsx("div",{className:"model-header",children:z[t]||`Model ${t+1}`},t))]}),a.map((c,t)=>e.jsxs("div",{className:"heatmap-row",children:[e.jsx("div",{className:"block-label",children:c.name}),c.weights.map((m,x)=>e.jsxs("div",{className:"heatmap-cell",style:{backgroundColor:`hsl(${m*120}, 70%, 30%)`},title:`Weight: ${m.toFixed(3)}, Density: ${c.densities[x].toFixed(3)}`,children:[e.jsx("div",{children:m.toFixed(2)}),e.jsxs("div",{style:{fontSize:"0.65rem",opacity:.8},children:["D:",c.densities[x].toFixed(2)]})]},x))]},t))]})]})},ue=we;let re=null;try{JSON.parse(ue)}catch(a){re=a instanceof Error?a.message:"Invalid JSON"}return e.jsxs("div",{className:"ties-config",children:[e.jsxs("div",{className:"config-header",children:[e.jsx("h2",{children:"TIES Merging Configuration"}),e.jsx("p",{children:"Create JSON configuration for ties_merging_with_json function"})]}),e.jsxs("div",{className:"config-content",children:[e.jsxs("div",{className:"controls-section",children:[e.jsxs("div",{className:"basic-controls",children:[e.jsxs("div",{className:"control-group",children:[e.jsx("label",{htmlFor:"num-models",children:"Number of Models (2-10):"}),e.jsxs("div",{className:"slider-with-value",children:[e.jsx("input",{id:"num-models",type:"range",min:"2",max:"10",value:i,onChange:a=>N(parseInt(a.target.value))}),e.jsx("span",{className:"slider-value",children:i})]})]}),e.jsx("div",{className:"control-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:J,onChange:a=>ie(a.target.checked)}),e.jsx("span",{children:"Show All Block Settings"})]})}),e.jsx("div",{className:"control-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:j,onChange:a=>I(a.target.checked)}),e.jsx("span",{children:"Show Advanced Settings"})]})})]}),Ce(),_e(),j&&e.jsxs("div",{className:"advanced-settings",children:[e.jsx("h3",{children:"Advanced Settings"}),e.jsxs("div",{className:"advanced-controls",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"cos-eps",children:"cos_eps (Model Stock):"}),e.jsx("input",{id:"cos-eps",type:"number",value:$,onChange:a=>U(parseFloat(a.target.value)),step:"1e-7",min:"1e-10"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"eps",children:"eps (Geometric Median):"}),e.jsx("input",{id:"eps",type:"number",value:S,onChange:a=>K(parseFloat(a.target.value)),step:"1e-7",min:"1e-10"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"maxiter",children:"maxiter (Geometric Median):"}),e.jsx("input",{id:"maxiter",type:"number",value:v,onChange:a=>G(parseInt(a.target.value)),min:"1"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"ftol",children:"ftol (Geometric Median):"}),e.jsx("input",{id:"ftol",type:"number",value:w,onChange:a=>R(parseFloat(a.target.value)),step:"1e-21",min:"1e-30"})]})]})]}),Fe(),e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{onClick:Se,className:"reset-btn",children:"Reset to Defaults"}),e.jsx(oe,{text:ue,label:"Copy JSON",disabled:re!==null||Object.keys(C).length>0})]}),re&&e.jsxs("div",{style:{color:"var(--error-color, #e74c3c)",fontSize:"0.85rem",marginTop:"0.5rem"},children:["JSON Error: ",re]})]}),e.jsxs("div",{className:"output-section",children:[Ee(),e.jsx(xe,{json:ue})]})]})]})}function Le(){const[i,N]=d.useState(2),[f,F]=d.useState([1,1]),[u,L]=d.useState(1),[$,U]=d.useState(.25),[S,K]=d.useState(!1),[v,G]=d.useState(!1),[w,R]=d.useState(!1),[P,X]=d.useState(!1),[D,q]=d.useState(1e-6),[B,Y]=d.useState(1e-6),[_,Q]=d.useState(100),[E,Z]=d.useState(1e-20),[C,A]=d.useState(["LoRA 1","LoRA 2"]),[o,r]=d.useState({});d.useEffect(()=>{const h=Array(i).fill(1);F(h)},[i]),d.useEffect(()=>{const h=Array.from({length:i},(z,W)=>`LoRA ${W+1}`);A(h)},[i]);const s=(h,z)=>{const W=[...f];W[h]=parseFloat(z),F(W)},l=()=>{const h=f.reduce((W,O)=>W+O,0);if(h===0)return;const z=f.map(W=>W/h);F(z)},n=(h,z)=>{const W=[...C];W[h]=z||`LoRA ${h+1}`,A(W)},p=h=>isNaN(h)?"Density must be a number":h<0||h>1?`Density must be between 0.0 and 1.0, got ${h}`:null,j=d.useMemo(()=>{const h={lambda:u,weights:f.map(z=>z.toFixed(3)).join(","),density:$,vote_sgn:S,apply_stock:v,apply_median:w};return D!==1e-6&&(h.cos_eps=D),B!==1e-6&&(h.eps=B),_!==100&&(h.maxiter=_),E!==1e-20&&(h.ftol=E),JSON.stringify(h,null,2)},[u,f,$,S,v,w,D,B,_,E]),I=()=>{const h=Array(i).fill(1);F(h),U(.25),L(1),K(!1),G(!1),R(!1),q(1e-6),Y(1e-6),Q(100),Z(1e-20),r({})},J=()=>e.jsxs("div",{className:"model-weights-section",children:[e.jsx("h3",{children:"LoRA Weights"}),e.jsx("div",{className:"model-sliders",children:f.map((h,z)=>e.jsxs("div",{className:"model-slider-container",children:[e.jsxs("div",{className:"slider-label-row",children:[e.jsx("input",{type:"text",value:C[z],onChange:W=>n(z,W.target.value),className:"model-name-input"}),e.jsxs("span",{children:[(h*100).toFixed(1),"%"]})]}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:h,onChange:W=>s(z,W.target.value),className:"slider"}),e.jsx("div",{className:"weight-value",children:h.toFixed(3)})]},z))}),e.jsx("div",{className:"normalize-row",children:e.jsx("button",{onClick:l,className:"normalize-btn",children:"Normalize Weights"})})]}),ie=()=>e.jsxs("div",{className:"global-settings-section",children:[e.jsx("h3",{children:"Global Settings"}),e.jsxs("div",{className:"global-controls",children:[e.jsxs("div",{className:"control-group",children:[e.jsx("label",{htmlFor:"lambda",children:"Lambda (scaling parameter):"}),e.jsx("input",{id:"lambda",type:"number",value:u,onChange:h=>L(parseFloat(h.target.value)),step:"0.1",className:"lambda-input"})]}),e.jsxs("div",{className:"control-group",children:[e.jsx("label",{htmlFor:"density",children:"Global Density (0.0-1.0):"}),e.jsxs("div",{className:"slider-with-value",children:[e.jsx("input",{id:"density",type:"range",min:"0",max:"1",step:"0.01",value:$,onChange:h=>{const z=parseFloat(h.target.value);U(z);const W=p(z);r(W?O=>({...O,density:W}):O=>{const ae={...O};return delete ae.density,ae})},className:"slider"}),e.jsxs("span",{className:"slider-value",children:[($*100).toFixed(0),"%"]})]}),e.jsx("div",{className:"density-value",children:$.toFixed(3)}),o.density&&e.jsx("small",{style:{color:"var(--error-color, #e74c3c)",fontSize:"0.75rem"},children:o.density}),!o.density&&e.jsxs("small",{style:{color:"var(--text-secondary, #bdc3c7)",fontSize:"0.75rem"},children:["Density controls TRIM step: top-",Math.round($*100),"% of parameters by magnitude"]})]}),e.jsxs("div",{className:"flags-group",children:[e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:S,onChange:h=>K(h.target.checked)}),e.jsx("span",{children:"vote_sgn"})]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:v,onChange:h=>{h.target.checked&&w?(G(!0),R(!1)):G(h.target.checked)},disabled:w===!0}),e.jsx("span",{children:"apply_stock"}),w&&e.jsx("small",{style:{color:"var(--text-secondary, #bdc3c7)",fontSize:"0.7rem",marginLeft:"0.25rem"},children:"(disabled when apply_median is enabled)"})]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:w,onChange:h=>{h.target.checked&&v?(R(!0),G(!1)):R(h.target.checked)}}),e.jsx("span",{children:"apply_median"}),w&&v&&e.jsx("small",{style:{color:"var(--warning-color, #f39c12)",fontSize:"0.7rem",marginLeft:"0.25rem"},children:"(has priority over apply_stock)"})]})]})]})]}),V=j;let ee=null;try{JSON.parse(V)}catch(h){ee=h instanceof Error?h.message:"Invalid JSON"}const M=v&&w;return e.jsxs("div",{className:"ties-lora-config",children:[e.jsxs("div",{className:"config-header",children:[e.jsx("h2",{children:"TIES LoRA Merging Configuration"}),e.jsx("p",{children:"Create JSON configuration for ties_lora_with_json function"})]}),e.jsxs("div",{className:"config-content",children:[e.jsxs("div",{className:"controls-section",children:[e.jsxs("div",{className:"basic-controls",children:[e.jsxs("div",{className:"control-group",children:[e.jsx("label",{htmlFor:"num-loras",children:"Number of LoRA (2-10):"}),e.jsxs("div",{className:"slider-with-value",children:[e.jsx("input",{id:"num-loras",type:"range",min:"2",max:"10",value:i,onChange:h=>N(parseInt(h.target.value))}),e.jsx("span",{className:"slider-value",children:i})]})]}),e.jsx("div",{className:"control-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:P,onChange:h=>X(h.target.checked)}),e.jsx("span",{children:"Show Advanced Settings"})]})})]}),ie(),J(),P&&e.jsxs("div",{className:"advanced-settings",children:[e.jsx("h3",{children:"Advanced Settings"}),e.jsxs("div",{className:"advanced-controls",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"cos-eps",children:"cos_eps (Model Stock):"}),e.jsx("input",{id:"cos-eps",type:"number",value:D,onChange:h=>q(parseFloat(h.target.value)),step:"1e-7",min:"1e-10"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"eps",children:"eps (Geometric Median):"}),e.jsx("input",{id:"eps",type:"number",value:B,onChange:h=>Y(parseFloat(h.target.value)),step:"1e-7",min:"1e-10"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"maxiter",children:"maxiter (Geometric Median):"}),e.jsx("input",{id:"maxiter",type:"number",value:_,onChange:h=>Q(parseInt(h.target.value)),min:"1"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"ftol",children:"ftol (Geometric Median):"}),e.jsx("input",{id:"ftol",type:"number",value:E,onChange:h=>Z(parseFloat(h.target.value)),step:"1e-21",min:"1e-30"})]})]})]}),e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{onClick:I,className:"reset-btn",children:"Reset to Defaults"}),e.jsx(oe,{text:V,label:"Copy JSON",disabled:ee!==null||Object.keys(o).length>0||M})]}),ee&&e.jsxs("div",{style:{color:"var(--error-color, #e74c3c)",fontSize:"0.85rem",marginTop:"0.5rem"},children:["JSON Error: ",ee]}),M&&e.jsx("div",{style:{color:"var(--error-color, #e74c3c)",fontSize:"0.85rem",marginTop:"0.5rem"},children:"Error: apply_stock and apply_median cannot both be enabled"})]}),e.jsx("div",{className:"output-section",children:e.jsx(xe,{json:V})})]})]})}function Ie(){const[i,N]=d.useState("karcher_mean");return e.jsxs("div",{className:"ritya-tools-container",children:[e.jsxs("div",{className:"tabs-header",children:[e.jsx(ge,{label:"Karcher Mean",active:i==="karcher_mean",onClick:()=>N("karcher_mean")}),e.jsx(ge,{label:"Weight Sum",active:i==="weight_sum",onClick:()=>N("weight_sum")}),e.jsx(ge,{label:"TIES Merging",active:i==="ties",onClick:()=>N("ties")}),e.jsx(ge,{label:"TIES LoRA",active:i==="ties_lora",onClick:()=>N("ties_lora")})]}),e.jsxs("div",{className:"tab-content",children:[i==="karcher_mean"&&e.jsx(Ae,{}),i==="weight_sum"&&e.jsx(ze,{}),i==="ties"&&e.jsx(Be,{}),i==="ties_lora"&&e.jsx(Le,{})]})]})}export{Ie as default};
